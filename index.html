<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="appTitle">AVNY.com</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome CDN for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Importer Google Fonts for Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000; /* ç´”é»‘èƒŒæ™¯ï¼Œä¿æŒç°¡æ½” */
            color: #FFFFFF; /* ç™½è‰²æ–‡å­— */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center; /* ç¢ºä¿å…§å®¹å±…ä¸­ */
            padding: 1.5rem; /* å¢åŠ æ•´é«”é é¢å…§é‚Šè· */
        }

        /* ä¸»è‰²èª¿ï¼šæ›´å…§æ–‚çš„ç´…è‰²å’Œç°è‰²ç³»åˆ— */
        .text-red-600 {
            color: #E53E3E; /* ç•¥å¾®æŸ”å’Œçš„ç´…è‰²ï¼Œæ›´å…·è¨­è¨ˆæ„Ÿ */
        }
        .bg-gray-800 {
            background-color: #1A1A1A; /* å€å¡ŠèƒŒæ™¯ï¼šæ·±ç°ï¼Œèˆ‡ç´”é»‘èƒŒæ™¯å½¢æˆå±¤æ¬¡æ„Ÿ */
        }
        /* æ›´æ”¹é‚Šæ¡†é¡è‰²ç‚ºæ›´æŸ”å’Œçš„ç°è‰² */
        .border-gray-700 {
            border-color: #4A5568; /* æŸ”å’Œçš„æ·±è—ç°ï¼Œå–ä»£ç´…è‰²é‚Šæ¡† */
        }
        .placeholder-text {
            color: #A0A0A0; /* ä½”ä½ç¬¦æ–‡å­—é¡è‰² */
        }
        .text-gray-400 { /* èª¿æ•´æ·ºç°æ–‡å­—é¡è‰²ï¼Œç¢ºä¿å¯è®€æ€§ */
            color: #CBD5E0;
        }

        /* æ»¾å‹•æ¢éš±è— */
        .scroll-container {
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        .scroll-container::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        /* è¨Šæ¯æç¤ºæ¡† */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #48BB78; /* æˆåŠŸè¨Šæ¯ç¶  */
            color: white;
            padding: 15px 30px;
            border-radius: 0.5rem; /* åœ“è§’é©ä¸­ */
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); /* æ›´æŸ”å’Œçš„é™°å½± */
            font-weight: 600; /* Semi-bold */
        }
        .message-box.error {
            background-color: #F56565; /* éŒ¯èª¤è¨Šæ¯ç´… */
        }

        /* è‡ªè¨‚ç¢ºèªå°è©±æ¡† */
        .confirm-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8); /* æ›´æ·±çš„åŠé€æ˜èƒŒæ™¯ */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001;
        }
        /* æš—é‡‘å±¬é¢¨æ ¼èƒŒæ™¯ */
        .dark-gold-metallic {
              background: linear-gradient(
                135deg,
                #4b3b0b,
                #665214,
                #a1861f,
                #5a4a12,
                #382f09
              );
              background-size: 400% 400%;
              animation: metallicShine 8s ease infinite;
              color: #f1e1a6; /* æ–‡å­—é¡è‰²å¯èª¿ */
        }

        /* æ¼¸å±¤é–ƒå‹•å‹•ç•« */
        @keyframes metallicShine {
              0% {
                    background-position: 0% 50%;
              }
              50% {
                    background-position: 100% 50%;
              }
              100% {
                    background-position: 0% 50%;
              }
        }
        .confirm-modal-content {
            background-color: #1A1A1A;
            padding: 2.5rem; /* å¢åŠ å…§é‚Šè· */
            border-radius: 0.75rem;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5); /* é¡¯è‘—ä½†æŸ”å’Œçš„é™°å½± */
            border: 1px solid #4A5568; /* æ›´æ”¹é‚Šæ¡†é¡è‰²ç‚ºæŸ”å’Œçš„æ·±è—ç° */
            text-align: center;
            max-width: 450px; /* ç¨å¾®å¯¬ä¸€é» */
            width: 90%;
        }
        .confirm-modal-content h3 {
            font-size: 1.875rem; /* æ›´å¤§çš„æ¨™é¡Œ */
            font-weight: 700; /* Bold */
            color: #FFFFFF;
            margin-bottom: 2rem; /* å¢åŠ é–“è· */
        }
        .confirm-modal-content .button-group {
            display: flex;
            justify-content: center;
            gap: 1.25rem; /* å¢åŠ æŒ‰éˆ•é–“è· */
        }
        .confirm-modal-content button {
            padding: 0.875rem 2rem; /* å¢å¤§æŒ‰éˆ•å°ºå¯¸ */
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s ease-in-out; /* æ›´å¿«çš„éæ¸¡æ•ˆæœ */
            letter-spacing: 0.025em; /* ç¨å¾®å¢åŠ å­—é–“è· */
        }
        .confirm-modal-content .confirm-button {
            background-color: #E53E3E;
            color: white;
        }
        .confirm-modal-content .confirm-button:hover {
            background-color: #C53030; /* æ›´æ·±çš„ç´…è‰² */
            transform: translateY(-2px); /* è¼•å¾®ä¸Šæµ®æ•ˆæœ */
        }
        .confirm-modal-content .cancel-button {
            background-color: #4A5568; /* æ·±è—ç° */
            color: white;
        }
        .confirm-modal-content .cancel-button:hover {
            background-color: #2D3748; /* æ›´æ·±çš„è—ç° */
            transform: translateY(-2px);
        }

        /* èªè¨€åˆ‡æ›ä¸‹æ‹‰é¸å–® - å›ºå®šåœ¨å³ä¸Šè§’ */
        .language-dropdown-container {
            position: fixed; /* å›ºå®šå®šä½ */
            top: 1.5rem; /* è·é›¢é ‚éƒ¨ */
            right: 1.5rem; /* è·é›¢å³å´ */
            z-index: 1050; /* ç¢ºä¿åœ¨æœ€ä¸Šå±¤ */
        }
        .language-dropdown-menu {
            position: absolute;
            right: 0; /* å°é½Šåˆ°å…¶å›ºå®šå®šä½çš„çˆ¶å…ƒç´ å³å´ */
            top: calc(100% + 10px); /* è·é›¢æŒ‰éˆ•ä¸‹æ–¹ */
            left: auto; /* å–æ¶ˆå·¦å´å®šä½ï¼Œäº¤çµ¦ right */
            background-color: #1A1A1A;
            min-width: 140px;
            box-shadow: 0px 8px 24px 0px rgba(0,0,0,0.6);
            z-index: 1;
            border-radius: 0.5rem;
            overflow: hidden;
            border: 1px solid #4A5568; /* æ›´æ”¹é‚Šæ¡†é¡è‰²ç‚ºæŸ”å’Œçš„æ·±è—ç° */
        }
        .language-dropdown-menu button {
            color: white;
            padding: 12px 18px;
            text-decoration: none;
            display: block;
            width: 100%;
            text-align: center;
            background-color: transparent;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
        }
        .language-dropdown-menu button:hover {
            background-color: #2D3748;
            transform: translateX(2px);
        }
        .language-dropdown-menu button.active {
            background-color: #E53E3E;
            font-weight: 700;
        }

        /* å¾Œå°åª’é«”é è¦½ */
        #actressMediaPreviewContainer {
            margin-top: 15px;
            border: 1px solid #4A5568; /* æ›´æ”¹é‚Šæ¡†é¡è‰²ç‚ºæŸ”å’Œçš„æ·±è—ç° */
            background-color: #2D3748;
            border-radius: 0.5rem;
        }
        #actressMediaPreviewContainer video,
        #actressMediaPreviewContainer iframe {
            width: 140px;
            height: 105px;
            border-radius: 0.375rem;
            border: none;
            background-color: #000;
        }
        #noMediaPreviewText, #videoLinkPreviewText {
            color: #A0A0A0;
            font-size: 0.95rem;
            margin-top: 5px;
            padding: 10px;
        }

        /* å»£å‘Šå€å¡Š */
        .ad-section {
            width: 100%;
            max-width: 768px;
            min-height: 100px;
            background-color: #1A1A1A;
            border: 1px solid #4A5568; /* æ›´æ”¹é‚Šæ¡†é¡è‰²ç‚ºæŸ”å’Œçš„æ·±è—ç° */
            color: #A0A0A0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.1rem;
            font-weight: 600;
            text-align: center;
            margin: 2.5rem auto;
            border-radius: 0.75rem;
            transition: border-color 0.3s ease;
        }
        .ad-section:hover {
            border-color: #E53E3E;
        }
        .ad-section img {
            max-width: 100%;
            height: auto;
            border-radius: 0.75rem; /* ä¿æŒåœ–ç‰‡åœ“è§’ */
        }

        /* Aspect ratio container for 3:4 video */
        .aspect-ratio-3-4 {
            position: relative;
            width: 100%;
            padding-bottom: calc(4 / 3 * 100%); /* Height / Width * 100% = 4/3 * 100% */
            overflow: hidden; /* Ensure content respects the border-radius of the parent */
            border-radius: 0.5rem; /* Match card border-radius */
            margin-bottom: 1rem; /* Match existing margin */
        }
        .aspect-ratio-3-4 iframe,
        .aspect-ratio-3-4 video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 0.5rem; /* Ensure video itself is rounded */
            border: 1px solid #2D3748; /* Match original video border */
        }

        /* å¥³å„ªå¡ç‰‡æœ¬èº« */
        .actress-card {
            background-color: #1A1A1A;
            padding: 1.25rem;
            border-radius: 0.75rem;
            box-shadow: none;
            border: 1px solid #2D3748; /* æ›´æ”¹é‚Šæ¡†é¡è‰²ç‚ºæŸ”å’Œçš„æ·±è—ç° */
            transition: all 0.2s ease-in-out;
            overflow: hidden; /* ç¢ºä¿å…§å®¹ä¸æœƒæº¢å‡ºåœ“è§’é‚Šæ¡† */
        }
        /* å¥³å„ªå¡ç‰‡hoveræ•ˆæœ */
        .actress-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border-color: #E53E3E;
            background-color: #2D3748; /* å°‡èƒŒæ™¯é¡è‰²æ”¹ç‚ºç•¥æ·±çš„ç°è‰²ï¼Œèˆ‡hoveræ•ˆæœä¸€è‡´ */
        }
        .actress-card h3 {
            font-weight: 600;
        }

        /* è©³ç´°è³‡è¨Šå½ˆå‡ºè¦–çª—åª’é«” */
        /* Updated for better responsive layout */
        #detailMediaContainer {
            margin-bottom: 1.5rem; /* Add some space below the video */
        }
        #detailMediaContainer .aspect-ratio-3-4 {
            /* The aspect ratio container will take 100% of its parent's width */
            width: 100%; 
            margin: 0 auto; /* Center it if its parent is smaller than 100% */
        }
        #detailMediaContainer iframe,
        #detailMediaContainer video {
            border-radius: 0.75rem;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid #4A5568; /* æ›´æ”¹é‚Šæ¡†é¡è‰²ç‚ºæŸ”å’Œçš„æ·±è—ç° */
        }

        /* Quiz specific styles - inherit minimalist aesthetic */
        .quiz-panel { /* Use a generic class for both quiz panels */
            position: relative; /* For absolute positioning of back button */
            background-color: #1A1A1A;
            padding: 2.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
            border: 1px solid #4A5568; /* æ›´æ”¹é‚Šæ¡†é¡è‰²ç‚ºæŸ”å’Œçš„æ·±è—ç° */
            max-width: 650px;
            width: 90%;
            margin-top: 2.5rem;
            text-align: center;
        }
        .quiz-panel h2 {
            font-size: 2.75rem;
            font-weight: 700;
            color: #E53E3E;
            margin-bottom: 2rem;
            letter-spacing: 0.05em;
        }
        .quiz-panel .quiz-question {
            font-size: 1.625rem;
            margin-bottom: 2rem;
            color: #FFFFFF;
            line-height: 1.4;
        }
        .quiz-panel .quiz-input {
            background-color: #000000;
            border: 1px solid #4A5568;
            color: #FFFFFF;
            padding: 0.875rem;
            border-radius: 0.5rem;
            font-size: 1.1rem;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .quiz-panel .quiz-input:focus {
            outline: none;
            border-color: #E53E3E;
            box-shadow: 0 0 0 3px rgba(229, 62, 62, 0.4);
        }
        .quiz-panel .quiz-input::placeholder {
            color: #A0A0A0;
        }
        .quiz-panel .quiz-buttons button {
            padding: 0.875rem 2.25rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            letter-spacing: 0.025em;
        }
        .quiz-panel .next-btn {
            background-color: #4299E1;
        }
        .quiz-panel .next-btn:hover {
            background-color: #3182CE;
            transform: translateY(-2px);
        }
        .quiz-panel .submit-btn {
            background-color: #48BB78;
        }
        .quiz-panel .submit-btn:hover {
            background-color: #38A169;
            transform: translateY(-2px);
        }
        .quiz-panel .quiz-result {
            margin-top: 2.5rem;
            font-size: 1.375rem;
            color: #FFFFFF;
            line-height: 1.5;
        }
        .quiz-panel .special-video-container {
            margin-top: 2.5rem;
            background-color: #000;
            border-radius: 0.75rem;
            overflow: hidden;
            width: 100%; /* Ensure it takes full width of parent */
            max-width: 560px; /* Standard YouTube embed width */
            margin-left: auto; /* Center the video */
            margin-right: auto;
        }
        .quiz-panel .special-video-container iframe {
            width: 100%; /* Make iframe responsive within its container */
            height: 315px; /* Standard 16:9 aspect ratio height for 560px width, adjust as needed */
            border: 1px solid #4A5568; /* æ›´æ”¹é‚Šæ¡†é¡è‰²ç‚ºæŸ”å’Œçš„æ·±è—ç° */
            border-radius: 0.75rem;
        }
        .quiz-panel .quiz-result button {
            background-color: #E53E3E;
            color: white;
            margin-top: 1.5rem;
            padding: 0.875rem 2.25rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            letter-spacing: 0.025em;
        }
        .quiz-panel .quiz-result button:hover {
            background-color: #C53030;
            transform: translateY(-2px);
        }
        /* Style for Ideal Actress Quiz Options */
        .ideal-quiz-option-button {
            width: 100%;
            padding: 0.875rem;
            border-radius: 0.5rem;
            background-color: #2D3748;
            color: white;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            text-align: left;
            border: 1px solid #4A5568;
        }
        .ideal-quiz-option-button:hover {
            background-color: #E53E3E;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }


        /* Header buttons common style */
        .header-button {
            padding: 0.75rem 1.25rem;
            border-radius: 0.5rem;
            background-color: #2D3748;
            color: white;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .header-button:hover {
            background-color: #E53E3E;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        /* èª¿æ•´è€å¸æ©Ÿå•ç­”æŒ‰éˆ•çš„å…·é«”æ¨£å¼ */
        #quizButtonsContainer .header-button {
            padding: 0.875rem 1.75rem; /* å¢åŠ  padding */
            font-size: 1.125rem; /* å¢å¤§å­—é«” */
            /* ç¹¼æ‰¿ .header-button çš„æ¨£å¼ */
        }

        /* Comments Section Styles */
        .comment-section {
            margin-top: 2.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #2D3748; /* Subtle separator */
        }
        .comment-section h3 {
            font-size: 1.875rem;
            font-weight: 700;
            color: #E53E3E;
            margin-bottom: 1.5rem;
        }
        .comment-input-area {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }
        .comment-input-area textarea {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            background-color: #000000;
            border: 1px solid #4A5568;
            color: #FFFFFF;
            font-size: 1rem;
            resize: vertical; /* Allow vertical resizing */
            min-height: 80px;
        }
        .comment-input-area button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            background-color: #4CAF50; /* Green submit button */
            color: white;
            font-weight: 600;
            align-self: flex-end; /* Align to the right */
            transition: background-color 0.2s ease;
        }
        .comment-input-area button:hover {
            background-color: #388E3C;
        }
        .comment-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .comment-item {
            background-color: #1F2937; /* Slightly lighter background for comments */
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #374151; /* Darker border for comments */
        }
        .comment-item .comment-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            color: #9CA3AF; /* Lighter grey for meta info */
            margin-bottom: 0.5rem;
        }
        .comment-item .comment-text {
            color: #FFFFFF;
            line-height: 1.5;
        }
    </style>
</head>
<body class="flex flex-col items-center p-4 sm:p-6 lg:p-8">

    <!-- èªè¨€åˆ‡æ›ä¸‹æ‹‰é¸å–® - ç¨ç«‹æ–¼ header ä¸¦å›ºå®šå®šä½ -->
    <div class="language-dropdown-container">
        <button id="languageDropdownButton" class="header-button">
            ZH-TW
        </button>
        <div id="languageDropdownMenu" class="language-dropdown-menu hidden">
            <!-- Language options will be inserted here by JavaScript -->
        </div>
    </div>

    <!-- Message Box for notifications -->
    <div id="messageBox" class="message-box"></div>

    <!-- Custom Confirmation Modal -->
    <div id="confirmDialog" class="confirm-modal-overlay hidden">
        <div class="confirm-modal-content">
            <h3 id="confirmMessage"></h3>
            <div class="button-group">
                <button id="confirmYes" class="confirm-button">æ˜¯</button>
                <button id="confirmNo" class="cancel-button">å¦</button>
            </div>
        </div>
    </div>

    <!-- ç¶²ç«™æ¨™é¡Œ -->
    <header class="w-full max-w-4xl text-center mb-8">
        <h1 id="appName" class="text-5xl sm:text-6xl font-extrabold text-red-600 tracking-wider mb-2">AVNY.com</h1>
        <p id="appSubtitle" class="text-white text-lg sm:text-xl font-light">å…¨çƒAVå¥³å„ªè³‡è¨Šæœå°‹å¹³å°</p>
        <div id="quizButtonsContainer" class="flex flex-wrap justify-center mt-4 space-x-2 space-y-2 sm:space-y-0">
            <button id="toggleAdminButton" class="header-button">æ·»åŠ å¥³å„ª</button>
            <button id="showQuizButton" class="header-button"></button>
            <button id="showIdealActressQuizButton" class="header-button"></button>
            <!-- èªè¨€åˆ‡æ›æŒ‰éˆ•å·²ç§»è‡³ç¨ç«‹çš„å›ºå®šå®šä½å®¹å™¨ -->
        </div>
        <div class="led-marquee-wrapper mt-6">
            <div class="led-marquee">
                ğŸ”¥ æ­¡è¿ä¾†åˆ° AVNY.com â€” æœ€æ–°è³‡è¨Šæ¯æ—¥æ›´æ–°ï¼Œæ­¡è¿åŠ å…¥æˆ‘å€‘çš„ Discord è¨è«–ç¤¾ç¾¤ï¼ğŸ”¥
            </div>
        </div>
    </header>

    <!-- ä»Šæ—¥æœ€è¾£ & æœ€æ–°ä¸Šç·š å€å¡Š -->
    <section id="homepageSections" class="w-full max-w-4xl mb-10">
        <!-- ä»Šæ—¥æœ€è¾£ -->
        <div class="bg-gray-800 p-6 rounded-xl border border-gray-700 mb-8"> <!-- æ›´æ”¹é‚Šæ¡†é¡è‰² -->
            <h2 id="hottestTitle" class="text-3xl font-bold text-red-600 mb-5 text-center">ä»Šæ—¥æœ€è¾£</h2>
            <div id="hottestActresses" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6">
                <!-- Hottest actresses will be rendered here -->
            </div>
        </div>

        <!-- æœ€æ–°ä¸Šç·š -->
        <div class="bg-gray-800 p-6 rounded-xl border border-gray-700 mb-8"> <!-- æ›´æ”¹é‚Šæ¡†é¡è‰² -->
            <h2 id="newlyAddedTitle" class="text-3xl font-bold text-red-600 mb-5 text-center">æœ€æ–°ä¸Šç·š</h2>
            <div id="newlyAddedActresses" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6">
                <!-- Newly added actresses will be rendered here -->
            </div>
        </div>
    </section>

    <!-- ä¸»ç¶²ç«™ä»‹é¢ (åŸæœ‰æœå°‹èˆ‡çµæœå€å¡Š) -->
    <div id="mainApp" class="w-full flex flex-col items-center">
        <!-- æœå°‹èˆ‡ç¯©é¸å€å¡Š -->
        <main class="w-full max-w-4xl bg-gray-800 p-7 rounded-xl border border-gray-700 mb-10"> <!-- æ›´æ”¹é‚Šæ¡†é¡è‰² -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-7">
                <!-- å¥³å„ªåå­—æœå°‹ -->
                <div>
                    <label for="nameSearch" id="nameSearchLabel" class="block text-white text-base font-medium mb-2">å¥³å„ªåå­—</label>
                    <input type="text" id="nameSearch" placeholder="è¼¸å…¥å¥³å„ªåå­—"
                           class="w-full p-3.5 rounded-lg bg-gray-900 border border-gray-700 text-white placeholder-text focus:outline-none focus:border-red-600 transition duration-300">
                </div>

                <!-- åœ‹ç±ç¯©é¸ -->
                <div>
                    <label for="nationalityFilter" id="nationalityFilterLabel" class="block text-white text-base font-medium mb-2">åœ‹ç±</label>
                    <select id="nationalityFilter"
                            class="w-full p-3.5 rounded-lg bg-gray-900 border border-gray-700 text-white focus:outline-none focus:border-red-600 transition duration-300">
                        <option value="" id="allNationalitiesOption">æ‰€æœ‰åœ‹ç±</option>
                        <option value="æ—¥æœ¬" id="japanNationalityOption">æ—¥æœ¬</option>
                        <option value="æ­ç¾" id="europeNationalityOption">æ­ç¾</option>
                        <option value="å—éŸ“" id="koreaNationalityOption">å—éŸ“</option>
                        <option value="ä¸­åœ‹" id="chinaNationalityOption">ä¸­åœ‹</option>
                        <!-- å¯åœ¨æ­¤è™•æ·»åŠ æ›´å¤šåœ‹ç±é¸é … -->
                    </select>
                </div>

                <!-- å¹´é½¡ç¯©é¸ (æ¯åå¹´ç‚ºä¸€å€‹å–®ä½) -->
                <div>
                    <label for="ageFilter" id="ageFilterLabel" class="block text-white text-base font-medium mb-2">å¹´é½¡å€é–“</label>
                    <select id="ageFilter"
                            class="w-full p-3.5 rounded-lg bg-gray-900 border border-gray-700 text-white focus:outline-none focus:border-red-600 transition duration-300">
                        <option value="" id="allAgesOption">æ‰€æœ‰å¹´é½¡</option>
                        <option value="18-29">18-29æ­²</option>
                        <option value="30-39">30-39æ­²</option>
                        <option value="40-49">40-49æ­²</option>
                        <!-- å¯åœ¨æ­¤è™•æ·»åŠ æ›´å¤šå¹´é½¡å€é–“ -->
                    </select>
                </div>

                <!-- ç½©æ¯ç¯©é¸ -->
                <div>
                    <label for="cupSizeFilter" id="cupSizeFilterLabel" class="block text-white text-base font-medium mb-2">ç½©æ¯</label>
                    <select id="cupSizeFilter"
                            class="w-full p-3.5 rounded-lg bg-gray-900 border border-gray-700 text-white focus:outline-none focus:border-red-600 transition duration-300">
                        <option value="" id="allCupSizesOption">æ‰€æœ‰ç½©æ¯</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="G">G</option>
                        <option value="H">H</option>
                        <option value="I">I</option>
                        <option value="J">J</option>
                        <option value="K">K</option>
                        <option value="L">L</option>
                        <option value="M">M">M</option>
                        <option value="N">N</option>
                        <option value="O">O</option>
                        <option value="P">P</option>
                        <!-- å¯åœ¨æ­¤è™•æ·»åŠ æ›´å¤šç½©æ¯é¸é … -->
                    </select>
                </div>
            </div>
            <button id="searchButton"
                    class="w-full py-4 px-7 rounded-lg bg-red-600 text-white font-bold text-xl hover:bg-red-700 transition duration-300 shadow-lg">
                æœå°‹å¥³å„ª
            </button>
        </main>

        <!-- æœå°‹çµæœå±•ç¤ºå€ -->
        <section id="resultsSection" class="w-full max-w-4xl grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6 mb-10"></section>

        <!-- å»£å‘Šæ¬„ä½ 1 -->
        <div id="adSection1" class="ad-section">
           <img src="https://drive.google.com/uc?export=view&id=1Q5piwFkOS6w1iUiGd2I66t4IG2WngJYc" 
                alt="å»£å‘Šåœ–" class="w-full h-auto rounded-lg shadow-md">
        </div>
        <!-- å»£å‘Šæ¬„ä½ 2 (ç¤ºç¯„ Google é›²ç«¯ç¡¬ç¢Ÿåœ–ç‰‡) -->
        <div id="adSection2" class="ad-section">
            <!-- Google Drive å»£å‘Šåœ–ç‰‡å°‡åœ¨æ­¤è™•é¡¯ç¤º -->
        </div>
        <!-- å»£å‘Šæ¬„ä½ 3 -->
        <div class="ad-section">
            <p>æ‚¨çš„å»£å‘Šå°‡é¡¯ç¤ºåœ¨æ­¤è™• (3)</p>
        </div>
    </div>

    <!-- å¾Œå°ç®¡ç†ä»‹é¢ -->
   <div id="passwordGate" class="fixed inset-0 z-50 bg-black bg-opacity-90 flex flex-col items-center justify-center text-white space-y-4 hidden">
          <h2 class="text-2xl font-bold">è«‹è¼¸å…¥ç®¡ç†å¯†ç¢¼</h2>
          <input type="password" id="adminPasswordInput" placeholder="è¼¸å…¥å¯†ç¢¼"
                 class="p-3 rounded text-black w-64 text-lg">
          <button id="submitPasswordBtn" class="bg-red-600 hover:bg-red-700 px-6 py-2 rounded text-white font-bold">é€²å…¥</button>
          <p id="passwordError" class="text-red-400 hidden">âŒ å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹å†è©¦ä¸€æ¬¡</p>
    </div>   
    <div id="adminPanel" class="w-full flex-col items-center hidden">
        <main class="w-full max-w-4xl bg-gray-800 p-7 rounded-xl border border-gray-700 mb-10"> <!-- æ›´æ”¹é‚Šæ¡†é¡è‰² -->
            <h2 id="addActressHeader" class="text-3xl font-bold text-red-600 mb-6 text-center">æ–°å¢å¥³å„ª</h2>
            <form id="actressForm" class="grid grid-cols-1 gap-5">
                <!-- Multi-language Name Inputs -->
                <div>
                    <label for="actressNameZhTw" class="block text-white text-base font-medium mb-2">å¥³å„ªå§“å (ç¹é«”ä¸­æ–‡)</label>
                    <input type="text" id="actressNameZhTw" required
                           class="w-full p-3.5 rounded-lg bg-gray-900 border border-gray-700 text-white placeholder-text focus:outline-none focus:border-red-600">
                </div>
                <div>
                    <label for="actressNameZhCn" class="block text-white text-base font-medium mb-2">å¥³å„ªå§“å (ç°¡é«”ä¸­æ–‡)</label>
                    <input type="text" id="actressNameZhCn"
                           class="w-full p-3.5 rounded-lg bg-gray-900 border border-gray-700 text-white placeholder-text focus:outline-none focus:border-red-600">
                </div>
                <div>
                    <label for="actressNameEn" class="block text-white text-base font-medium mb-2">å¥³å„ªå§“å (è‹±æ–‡)</label>
                    <input type="text" id="actressNameEn"
                           class="w-full p-3.5 rounded-lg bg-gray-900 border border-gray-700 text-white placeholder-text focus:outline-none focus:border-red-600">
                </div>
                <div>
                    <label for="actressNameJa" class="block text-white text-base font-medium mb-2">å¥³å„ªå§“å (æ—¥æ–‡)</label>
                    <input type="text" id="actressNameJa"
                           class="w-full p-3.5 rounded-lg bg-gray-900 border border-gray-700 text-white placeholder-text focus:outline-none focus:border-red-600">
                </div>

                <div>
                    <label for="actressNationality" id="nationalityLabelAdmin" class="block text-white text-base font-medium mb-2">åœ‹ç±</label>
                    <input type="text" id="actressNationality" value="æ—¥æœ¬" required
                           class="w-full p-3.5 rounded-lg bg-gray-900 border border-gray-700 text-white placeholder-text focus:outline-none focus:border-red-600">
                </div>
                <div>
                    <label for="actressBirthDate" id="birthDateLabel" class="block text-white text-base font-medium mb-2">å‡ºç”Ÿæ—¥æœŸ (YYYY-MM-DD)</label>
                    <input type="date" id="actressBirthDate" required
                           class="w-full p-3.5 rounded-lg bg-gray-900 border border-gray-700 text-white placeholder-text focus:outline-none focus:border-red-600">
                </div>
                <div>
                    <label for="actressCupSize" id="cupSizeLabelAdmin" class="block text-white text-base font-medium mb-2">ç½©æ¯</label>
                    <input type="text" id="actressCupSize" required placeholder="ä¾‹å¦‚: E"
                           class="w-full p-3.5 rounded-lg bg-gray-900 border border-gray-700 text-white placeholder-text focus:outline-none focus:border-red-600">
                </div>
                
                <div class="flex items-center mt-4">
                    <input type="checkbox" id="actressIsLegend" class="mr-2">
                    <label for="actressIsLegend" class="text-white">å‚³å¥‡äººç‰© (Legend)</label>
                </div>  
                <div>
                    <label for="actressDescription" id="descriptionLabelAdmin" class="block text-white text-base font-medium mb-2">ç°¡ä»‹</label>
                    <textarea id="actressDescription"
                          class="w-full p-3.5 rounded-lg bg-gray-900 border border-gray-700 text-white placeholder-text focus:outline-none focus:border-red-600"
                          placeholder="è¼¸å…¥å¥³å„ªç°¡ä»‹..."></textarea>
                </div>

                <div>
                    <label for="actressDetailedInfo" id="detailedInfoLabelAdmin" class="block text-white text-base font-medium mb-2">è©³ç´°è³‡æ–™</label>
                    <textarea id="actressDetailedInfo"
                          class="w-full p-3.5 rounded-lg bg-gray-900 border border-gray-700 text-white placeholder-text focus:outline-none focus:border-red-600"
                          placeholder="è¼¸å…¥å¥³å„ªè©³ç´°è³‡æ–™..."></textarea>
                </div>
                <div>
                    <label for="actressMediaUrl" id="mediaUrlLabel" class="block text-white text-base font-medium mb-2">å½±ç‰‡URL (é™YouTube)</label>
                    <input type="url" id="actressMediaUrl"
                           class="w-full p-3.5 rounded-lg bg-gray-900 border border-gray-700 text-white placeholder-text focus:outline-none focus:border-red-600">
                    <!-- Removed file upload elements -->
                    <div id="actressMediaPreviewContainer">
                        <!-- Media preview will be dynamically inserted here -->
                        <p id="noMediaPreviewText" class="text-gray-400">è²¼ä¸ŠYouTubeå½±ç‰‡URLå¾Œå°‡åœ¨æ­¤é¡¯ç¤ºé è¦½</p>
                    </div>
                </div>
                <div>
                    <label for="actressRecommendedVideoUrl" id="recommendedVideoUrlLabel" class="block text-white text-base font-medium mb-2">æ¨è–¦å½±ç‰‡URL</label>
                    <input type="url" id="actressRecommendedVideoUrl"
                           class="w-full p-3.5 rounded-lg bg-gray-900 border border-gray-700 text-white placeholder-text focus:outline-none focus:border-red-600">
                    <div id="videoLinkPreviewContainer">
                        <p id="videoLinkPreviewText" class="text-gray-400">è²¼ä¸Šå½±ç‰‡URLå¾Œå°‡åœ¨æ­¤é¡¯ç¤ºé€£çµæç¤º</p>
                    </div>
                </div>
                <div>
                    <label for="actressWikipediaLink" id="wikipediaLinkLabelAdmin" class="block text-white text-base font-medium mb-2">ç¶­åŸºç™¾ç§‘é€£çµ</label>
                    <input type="url" id="actressWikipediaLink"
                           class="w-full p-3.5 rounded-lg bg-gray-900 border border-gray-700 text-white placeholder-text focus:outline-none focus:border-red-600">
                </div>
                <button type="submit" id="addEditActressButton"
                        class="w-full py-4 px-7 rounded-lg bg-red-600 text-white font-bold text-xl hover:bg-red-700 transition duration-300 shadow-lg">
                    æ–°å¢
                </button>
                <button type="button" id="cancelEditButton" class="w-full py-4 px-7 rounded-lg bg-gray-600 text-white font-bold text-xl hover:bg-gray-700 transition duration-300 shadow-lg hidden">
                    å–æ¶ˆç·¨è¼¯
                </button>
            </form>
        </main>

        <section class="w-full max-w-4xl bg-gray-800 p-7 rounded-xl border border-gray-700"> <!-- æ›´æ”¹é‚Šæ¡†é¡è‰² -->
            <h2 id="manageActressesHeader" class="text-3xl font-bold text-red-600 mb-6 text-center">ç®¡ç†å¥³å„ªè³‡æ–™</h2>
            <div id="adminActressList" class="space-y-5">
                <!-- å¥³å„ªåˆ—è¡¨å°‡ç”±JavaScriptæ¸²æŸ“ -->
            </div>
        </section>
    </div>

    <!-- æ¸¬é©—éŠæˆ²ä»‹é¢ -->
    <div id="quizPanel" class="quiz-panel hidden">
        <button id="backToMainFromQuiz" class="absolute top-6 left-6 header-button">è¿”å›ä¸»é </button>
        <h2 id="quizTitle"></h2>
        <p id="quizQuestion" class="quiz-question"></p>
        <input type="text" id="quizInput" class="w-full p-3.5 rounded-lg bg-gray-900 border border-gray-700 text-white placeholder-text focus:outline-none focus:border-red-600 quiz-input" placeholder="">
        <div id="quizButtons" class="mt-5 flex justify-center space-x-5 quiz-buttons">
            <button id="nextQuestionButton" class="py-3.5 px-7 rounded-lg bg-blue-600 text-white font-bold text-lg hover:bg-blue-700 transition duration-300 shadow-md next-btn"></button>
            <button id="submitQuizButton" class="py-3.5 px-7 rounded-lg bg-green-600 text-white font-bold text-lg hover:bg-green-700 transition duration-300 shadow-md submit-btn hidden"></button>
        </div>
        <div id="quizResult" class="hidden quiz-result">
            <p id="quizScoreText"></p>
            <p id="quizResultMessage" class="mt-5"></p>
            <button id="viewSpecialVideoButton" class="py-3.5 px-7 rounded-lg bg-red-600 text-white font-bold text-lg hover:bg-red-700 transition duration-300 shadow-md hidden"></button>
            <button id="tryAgainButton" class="py-3.5 px-7 rounded-lg bg-red-600 text-white font-bold text-lg hover:bg-red-700 transition duration-300 shadow-md hidden"></button>
            <div id="specialVideoContainer" class="hidden special-video-container">
                <iframe id="specialVideoPlayer" frameborder="0" allow="autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
    </div>

    <!-- ç†æƒ³å¥³å„ªæ¸¬é©—éŠæˆ²ä»‹é¢ -->
    <div id="idealActressQuizPanel" class="quiz-panel hidden">
        <button id="backToMainFromIdealQuiz" class="absolute top-6 left-6 header-button">è¿”å›ä¸»é </button>
        <h2 id="idealActressQuizTitle"></h2>
        <p id="idealActressQuizQuestion" class="quiz-question"></p>
        <div id="idealActressQuizOptions" class="flex flex-col space-y-4 mt-5">
            <!-- Options will be rendered here -->
        </div>
        <div id="idealActressQuizResult" class="hidden quiz-result">
            <p id="idealActressQuizResultText"></p>
            <div id="idealActressResultVideoContainer" class="hidden special-video-container mt-4">
                <iframe id="idealActressResultVideoPlayer" frameborder="0" allow="autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
            <button id="idealActressTryAgainButton" class="py-3.5 px-7 rounded-lg bg-red-600 text-white font-bold text-lg hover:bg-red-700 transition duration-300 shadow-md mt-5"></button>
        </div>
    </div>


    <!-- å¥³å„ªè©³ç´°è³‡è¨Šå½ˆå‡ºè¦–çª— (Modal) -->
    <div id="actressDetailModal" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-gray-800 p-8 rounded-xl border border-gray-700 w-full max-w-2xl max-h-[90vh] overflow-y-auto scroll-container relative"> <!-- æ›´æ”¹é‚Šæ¡†é¡è‰² -->
            <button id="closeModalButton" class="absolute top-4 right-4 text-white text-4xl font-bold hover:text-red-600 transition duration-300">&times;</button>
            <h2 id="detailName" class="text-4xl font-bold text-red-600 mb-5 text-center"></h2>
            <div class="flex flex-col md:flex-row items-center md:items-start gap-7">
                <!-- Media will be dynamically inserted here -->
                <div id="detailMediaContainer" class="w-full md:w-1/2 lg:w-1/3 flex-shrink-0">
                    <!-- Dynamic video or iframe here. The aspect-ratio-3-4 class will be applied by JS for width/height -->
                </div>
                <div class="text-white text-base flex-grow space-y-3 w-full md:w-1/2 lg:w-2/3">
                    <p><strong id="detailNationalityLabel" class="text-red-600">åœ‹ç±ï¼š</strong> <span id="detailNationality"></span></p>
                    <p><strong id="detailAgeLabel" class="text-red-600">å¹´é½¡ï¼š</strong> <span id="detailAge"></span></p>
                    <p><strong id="detailCupSizeLabel" class="text-red-600">ç½©æ¯ï¼š</strong> <span id="detailCupSize"></span></p>
                   
                <div class="text-left mt-4">
                    <h3 id="detailDescriptionLabel" class="text-xl font-semibold text-white mb-2">ç°¡ä»‹</h3>
                    <p id="detailDescription" class="text-gray-300 text-base leading-relaxed whitespace-pre-wrap"></p>
                </div>

                <div class="text-left mt-4">
                    <h3 id="detailDetailedInfoLabel" class="text-xl font-semibold text-white mb-2">è©³ç´°è³‡æ–™</h3>
                    <p id="detailDetailedInfo" class="text-gray-300 text-base leading-relaxed whitespace-pre-wrap"></p>
                </div>

                    <p class="flex items-center"><strong id="detailLikesLabel" class="text-red-600">æ‡‰æ´æ•¸ï¼š</strong> <span id="modalLikesCount" class="ml-2 text-lg font-semibold"></span></p>
                    <button id="detailLikeButton" class="py-3 px-6 rounded-lg bg-red-600 text-white font-bold text-lg hover:bg-red-700 transition duration-300 shadow-md mt-3">
                        <i class="fas fa-heart mr-2"></i> <span id="supportActressText"></span>
                    </button>
                    <p class="mt-5" id="detailRecommendedVideoContainer">
                        <strong id="detailRecommendedVideoLabel" class="text-red-600">æ¨è–¦å½±ç‰‡ï¼š</strong>
                        <a id="detailRecommendedVideoLink" href="#" target="_blank" class="text-red-500 hover:underline block mt-2">é»æ­¤è§€çœ‹å½±ç‰‡</a>
                        <!-- å½±ç‰‡ç¸®åœ–å°‡ä¸å†é¡¯ç¤º -->
                    </p>
                    <p id="detailWikipediaLink" class="text-sm mt-3">
                        <strong class="text-red-600">ç¶­åŸºç™¾ç§‘ï¼š</strong> <a href="#" target="_blank" class="text-red-500 hover:underline">é»æ­¤æŸ¥çœ‹æ›´å¤š</a>
                    </p>
                </div>
            </div>
      </div>
            <!-- ç¶²å‹ç•™è¨€å€ -->
            <div id="commentsSection" class="comment-section">
                <h3 id="commentsTitle">ç¶²å‹ç•™è¨€å€</h3>
                <div class="comment-input-area">
                    <textarea id="commentTextarea" placeholder="è¼¸å…¥æ‚¨çš„ç•™è¨€..."></textarea>
                    <button id="submitCommentButton">ç•™è¨€</button>
                </div>
                <div id="commentList" class="comment-list">
                    <!-- Comments will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // Firebase æ¨¡çµ„å¼•å…¥
        // ç¢ºä¿é€™äº› CDN é€£çµæ˜¯æ‚¨ Firebase å°ˆæ¡ˆä¸­ä½¿ç”¨çš„ç‰ˆæœ¬
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, doc, onSnapshot, updateDoc, deleteDoc, query, where, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

        // ** é‡è¦ï¼šFirebase åˆå§‹åŒ–è®Šæ•¸ - è«‹å°‡é€™äº›æ›¿æ›ç‚ºæ‚¨è‡ªå·±çš„ Firebase å°ˆæ¡ˆè³‡è¨Š **
        // æ‚¨å¯ä»¥å¾ Firebase æ§åˆ¶å°çš„ã€Œå°ˆæ¡ˆè¨­å®šã€ä¸­æ‰¾åˆ°é€™äº›è³‡è¨Š
        // ã€Œå°ˆæ¡ˆ IDã€æœƒæ˜¯æ‚¨ Firestore è·¯å¾‘çš„ä¸€éƒ¨åˆ†ï¼Œä¾‹å¦‚åœ¨ artifacts/{appId}/... ä¸­
        const appId = 'AVNY.com'; // <-- è«‹æ›¿æ›ç‚ºæ‚¨çš„ Firebase å°ˆæ¡ˆ ID

        // å¾ Firebase æ§åˆ¶å° > å°ˆæ¡ˆè¨­å®š > æ‚¨çš„æ‡‰ç”¨ç¨‹å¼ > Web æ‡‰ç”¨ç¨‹å¼ï¼Œè¤‡è£½æ­¤é…ç½®ç‰©ä»¶
        const firebaseConfig = {
         apiKey: "AIzaSyCZSC4KP9r9Ia74gjhVM4hkhkCiXU6ltR4",
         authDomain: "avny-ccbe9.firebaseapp.com",
         databaseURL: "https://avny-ccbe9-default-rtdb.firebaseio.com",
         projectId: "avny-ccbe9",
         storageBucket: "avny-ccbe9.firebasestorage.app",
         messagingSenderId: "686829295344",
         appId: "1:686829295344:web:f77918a8265e5ea5701435",
         measurementId: "G-492M2JYYEQ"
            // measurementId: "YOUR_MEASUREMENT_ID" // å¦‚æœæœ‰ï¼Œä¹Ÿè«‹åŠ ä¸Š
        };
        // ** é‡è¦ï¼šFirebase åˆå§‹åŒ–è®Šæ•¸çµæŸ **

        let app;
        let db;
        let auth;
        let actressesCollection;
        let currentUserId = null;
        let isAuthReady = false;

        // é é¢å…ƒç´ ç²å–
        const homepageSections = document.getElementById('homepageSections'); // New for hiding sections
        const mainApp = document.getElementById('mainApp');
        const adminPanel = document.getElementById('adminPanel');
        const quizPanel = document.getElementById('quizPanel'); // New quiz panel
        const idealActressQuizPanel = document.getElementById('idealActressQuizPanel'); // New ideal actress quiz panel

        const toggleAdminButton = document.getElementById('toggleAdminButton');
        const showQuizButton = document.getElementById('showQuizButton'); // Old quiz button
        const showIdealActressQuizButton = document.getElementById('showIdealActressQuizButton'); // New quiz button

        const backToMainFromQuizButton = document.getElementById('backToMainFromQuiz'); // Old quiz back button
        const backToMainFromIdealQuizButton = document.getElementById('backToMainFromIdealQuiz'); // New quiz back button

        let adminPanelVisible = false;

        const nameSearchInput = document.getElementById('nameSearch');
        const nationalityFilter = document.getElementById('nationalityFilter');
        const ageFilter = document.getElementById('ageFilter');
        const cupSizeFilter = document.getElementById('cupSizeFilter');
        const searchButton = document.getElementById('searchButton');
        const resultsSection = document.getElementById('resultsSection');
        const actressDetailModal = document.getElementById('actressDetailModal');
        const closeModalButton = document.getElementById('closeModalButton');
        const detailName = document.getElementById('detailName');
        const detailMediaContainer = document.getElementById('detailMediaContainer');
        const detailNationality = document.getElementById('detailNationality');
        const detailAge = document.getElementById('detailAge');
        const detailCupSize = document.getElementById('detailCupSize');
        const detailDescription = document.getElementById('detailDescription');
        const detailDetailedInfo = document.getElementById('detailDetailedInfo');
        const detailWikipediaLink = document.getElementById('detailWikipediaLink').querySelector('a');
        const detailRecommendedVideoContainer = document.getElementById('detailRecommendedVideoContainer');
        const detailRecommendedVideoLink = document.getElementById('detailRecommendedVideoLink');

        // New elements for likes in modal
        const modalLikesCount = document.getElementById('modalLikesCount');
        const detailLikeButton = document.getElementById('detailLikeButton');
        const supportActressText = document.getElementById('supportActressText');

        // Quiz elements (Old)
        const quizTitle = document.getElementById('quizTitle');
        const quizQuestionElement = document.getElementById('quizQuestion');
        const quizInput = document.getElementById('quizInput');
        const nextQuestionButton = document.getElementById('nextQuestionButton');
        const submitQuizButton = document.getElementById('submitQuizButton');
        const quizResultSection = document.getElementById('quizResult');
        const quizScoreText = document.getElementById('quizScoreText');
        const quizResultMessage = document.getElementById('quizResultMessage');
        const viewSpecialVideoButton = document.getElementById('viewSpecialVideoButton');
        const tryAgainButton = document.getElementById('tryAgainButton');
        const specialVideoContainer = document.getElementById('specialVideoContainer');
        const specialVideoPlayer = document.getElementById('specialVideoPlayer');

        // Ideal Actress Quiz elements (New)
        const idealActressQuizTitle = document.getElementById('idealActressQuizTitle');
        const idealActressQuizQuestionElement = document.getElementById('idealActressQuizQuestion');
        const idealActressQuizOptionsContainer = document.getElementById('idealActressQuizOptions');
        const idealActressQuizResultSection = document.getElementById('idealActressQuizResult');
        const idealActressQuizResultText = document.getElementById('idealActressQuizResultText');
        const idealActressResultVideoContainer = document.getElementById('idealActressResultVideoContainer');
        const idealActressResultVideoPlayer = document.getElementById('idealActressResultVideoPlayer');
        const idealActressTryAgainButton = document.getElementById('idealActressTryAgainButton');


        const actressForm = document.getElementById('actressForm');
        // Multi-language name input fields
        const actressNameZhTwInput = document.getElementById('actressNameZhTw');
        const actressNameZhCnInput = document.getElementById('actressNameZhCn');
        const actressNameEnInput = document.getElementById('actressNameEn');
        const actressNameJaInput = document.getElementById('actressNameJa');

        const actressNationalityInput = document.getElementById('actressNationality');
        const actressBirthDateInput = document.getElementById('actressBirthDate');
        const actressCupSizeInput = document.getElementById('actressCupSize');
        const actressDescriptionInput = document.getElementById('actressDescription'); // æ–°å¢
        const actressDetailedInfoInput = document.getElementById('actressDetailedInfo'); // æ–°å¢
        const actressIsLegendInput = document.getElementById('actressIsLegend');
        const actressMediaUrlInput = document.getElementById('actressMediaUrl');
        const actressRecommendedVideoUrlInput = document.getElementById('actressRecommendedVideoUrl'); 
        const actressWikipediaLinkInput = document.getElementById('actressWikipediaLink');
        const addEditActressButton = document.getElementById('addEditActressButton');
        const cancelEditButton = document.getElementById('cancelEditButton');
        const adminActressList = document.getElementById('adminActressList');
        let editingActressId = null; // ç”¨æ–¼å„²å­˜ç•¶å‰ç·¨è¼¯çš„å¥³å„ªID

        const messageBox = document.getElementById('messageBox');

        // Custom Confirmation Modal elements
        const confirmDialog = document.getElementById('confirmDialog');
        const confirmMessage = document.getElementById('confirmMessage');
        const confirmYesButton = document.getElementById('confirmYes');
        const confirmNoButton = document.getElementById('confirmNo');
        let currentConfirmCallback = null; // Stores the callback function for the confirmation

        // Language Dropdown elements
        const languageDropdownButton = document.getElementById('languageDropdownButton');
        const languageDropdownMenu = document.getElementById('languageDropdownMenu');

        // Admin panel media preview elements
        const actressMediaPreviewContainer = document.getElementById('actressMediaPreviewContainer');
        const noMediaPreviewText = document.getElementById('noMediaPreviewText');
        const videoLinkPreviewText = document.getElementById('videoLinkPreviewText'); 

        // New elements for Hottest/Newly Added sections
        const hottestTitle = document.getElementById('hottestTitle');
        const newlyAddedTitle = document.getElementById('newlyAddedTitle');
        const hottestActressesContainer = document.getElementById('hottestActresses');
        const newlyAddedActressesContainer = document.getElementById('newlyAddedActresses');

        // Ad Section elements
        const adSection1 = document.getElementById('adSection1');
        const adSection2 = document.getElementById('adSection2'); // New ad section for Google Drive demo

        // Comments elements
        const commentsSection = document.getElementById('commentsSection');
        const commentsTitle = document.getElementById('commentsTitle');
        const commentTextarea = document.getElementById('commentTextarea');
        const submitCommentButton = document.getElementById('submitCommentButton');
        const commentList = document.getElementById('commentList');

        let currentActressIdForComments = null; // To store the ID of the actress whose comments are currently displayed
        let unsubscribeComments = null; // To store the unsubscribe function for the comments listener

        // Helper to get actress name based on current language
        function getActressNameByLang(actress, lang) {
            const nameField = `name_${lang.replace('-', '_')}`; // e.g., 'zh-TW' -> 'name_zh_TW'
            return actress[nameField] || actress.name_zh_TW || actress.name_en || actress.name_ja || "æœªçŸ¥å¥³å„ª"; // Fallback
        }

        // --- å¤šåœ‹èªè¨€è¨­å®š ---
        const translations = {
            'zh-TW': {
                appName: "AVNY.com",
                appSubtitle: "å…¨çƒAVå¥³å„ªè³‡è¨Šæœå°‹å¹³å°",
                searchName: "å¥³å„ªåå­—",
                inputPlaceholder: "è¼¸å…¥å¥³å„ªåå­—",
                nationality: "åœ‹ç±",
                allNationalities: "æ‰€æœ‰åœ‹ç±",
                japan: "æ—¥æœ¬",
                europe: "æ­ç¾",
                korea: "å—éŸ“",
                china: "ä¸­åœ‹",
                ageGroup: "å¹´é½¡å€é–“",
                allAges: "æ‰€æœ‰å¹´é½¡",
                cupSize: "ç½©æ¯",
                allCupSizes: "æ‰€æœ‰ç½©æ¯",
                searchButton: "æœå°‹å¥³å„ª",
                noResults: "æœªæ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„å¥³å„ªã€‚",
                detailNationality: "åœ‹ç±",
                detailAge: "æ­²", 
                detailCupSize: "ç½©æ¯",
                detailDescription: "ç°¡ä»‹",
                detailDetailedInfo: "è©³ç´°è³‡æ–™",
                detailWikipedia: "ç¶­åŸºç™¾ç§‘",
                viewMore: "é»æ­¤æŸ¥çœ‹æ›´å¤š",
                viewVideo: "é»æ­¤è§€çœ‹å½±ç‰‡",
                close: "Ã—",
                adminPanel: "æ·»åŠ å¥³å„ª",
                mainSite: "ä¸»è¦ç¶²ç«™",
                addActress: "æ–°å¢å¥³å„ª",
                editActress: "ç·¨è¼¯å¥³å„ª",
                actressName: "å¥³å„ªå§“å", // This will be replaced by specific language labels for admin form
                actressNameZhTw: "å¥³å„ªå§“å (ç¹é«”ä¸­æ–‡)",
                actressNameZhCn: "å¥³å„ªå§“å (ç°¡é«”ä¸­æ–‡)",
                actressNameEn: "å¥³å„ªå§“å (è‹±æ–‡)",
                actressNameJa: "å¥³å„ªå§“å (æ—¥æ–‡)",
                birthDate: "å‡ºç”Ÿæ—¥æœŸ (YYYY-MM-DD)",
                mediaURL: "å½±ç‰‡URL (é™YouTubeæˆ–Googleé›²ç«¯ç¡¬ç¢Ÿ)", // Updated label
                recommendedVideoURL: "æ¨è–¦å½±ç‰‡URL",
                add: "æ–°å¢",
                save: "å„²å­˜",
                manageActresses: "ç®¡ç†å¥³å„ªè³‡æ–™",
                edit: "ç·¨è¼¯",
                delete: "åˆªé™¤",
                confirmDelete: "ç¢ºå®šè¦åˆªé™¤é€™ç­†è³‡æ–™å—ï¼Ÿ",
                dataSaved: "è³‡æ–™å·²å„²å­˜ï¼",
                dataDeleted: "è³‡æ–™å·²åˆªé™¤ï¼",
                dataError: "æ“ä½œå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚",
                unknown: "æœªçŸ¥",
                confirmTitle: "ç¢ºèªåˆªé™¤",
                confirmMessageText: "æ‚¨ç¢ºå®šè¦åˆªé™¤é€™ç­†å¥³å„ªè³‡æ–™å—ï¼Ÿ",
                ageLabelText: "å¹´é½¡",
                invalidMedia: "ç„¡æ•ˆå½±ç‰‡URLæˆ–ç„¡æ³•è¼‰å…¥ (è«‹ç¢ºèªç‚ºå…¬é–‹/éå…¬é–‹YouTubeæˆ–Googleé›²ç«¯ç¡¬ç¢Ÿé€£çµ)", // Updated error message
                mediaPreviewHint: "è²¼ä¸ŠYouTubeå½±ç‰‡URLå¾Œå°‡åœ¨æ­¤é¡¯ç¤ºé è¦½ (åƒ…æ”¯æ´å…¬é–‹/éå…¬é–‹å½±ç‰‡)", // Updated hint to include private video note
                videoLinkHint: "è²¼ä¸Šå½±ç‰‡URLå¾Œå°‡åœ¨æ­¤é¡¯ç¤ºé€£çµæç¤º", 
                videoLinkGenerated: "å°‡ç”¢ç”Ÿå¯é»æ“Šçš„å½±ç‰‡é€£çµ", 
                recommendedVideo: "æ¨è–¦å½±ç‰‡",
                hottestToday: "ä»Šæ—¥æœ€è¾£", // New translation
                newlyAdded: "æœ€æ–°ä¸Šç·š", // New translation
                likesLabel: "æ‡‰æ´æ•¸", // New translation
                supportActress: "æ‡‰æ´å¥³å„ª", // New translation
                supportMessage: "æ„Ÿè¬æ‚¨çš„æ‡‰æ´ï¼", // New translation
                oldDriverQuizTitle: "è€å¸æ©Ÿå°±æ˜¯æˆ‘", // Quiz translation name change
                idealActressQuizTitle: "èª°æ˜¯æˆ‘çš„ç†æƒ³å¥³å„ªï¼Ÿ", // New quiz title
                backToMain: "è¿”å›ä¸»é ",
                quizQuestionNum: "ç¬¬",
                quizQuestionText: "é¡Œ",
                enterYourAnswer: "è¼¸å…¥ä½ çš„ç­”æ¡ˆ",
                nextQuestion: "ä¸‹ä¸€é¡Œ",
                finishQuiz: "å®Œæˆ",
                congratulations: "æ­å–œï¼",
                watchSpecialVideo: "è§€çœ‹ç‰¹æ®Šå½±ç‰‡",
                failedQuiz: "æŠ±æ­‰ï¼Œæ‚¨æ²’æœ‰å…¨éƒ¨ç­”å°ã€‚",
                tryAgain: "å†è©¦ä¸€æ¬¡",
                yourScore: "ä½ çš„åˆ†æ•¸",
                question: "å•é¡Œ",
                correctAnswer: "æ­£ç¢ºç­”æ¡ˆ",
                commentsSectionTitle: "ç¶²å‹ç•™è¨€å€", // New
                commentPlaceholder: "è¼¸å…¥æ‚¨çš„ç•™è¨€...", // New
                commentButton: "ç•™è¨€", // New
                anonymousUser: "åŒ¿åä½¿ç”¨è€…", // New
            },
            'zh-CN': {
                appName: "AVNY.com",
                appSubtitle: "å…¨çƒAVå¥³ä¼˜ä¿¡æ¯æœç´¢å¹³å°",
                searchName: "å¥³ä¼˜åå­—",
                inputPlaceholder: "è¾“å…¥å¥³ä¼˜åå­—",
                nationality: "å›½ç±",
                allNationalities: "æ‰€æœ‰å›½ç±",
                japan: "æ—¥æœ¬",
                europe: "æ¬§ç¾",
                korea: "å—éŸ©",
                china: "ä¸­å›½",
                ageGroup: "å¹´é¾„åŒºé—´",
                allAges: "æ‰€æœ‰å¹´é¾„",
                cupSize: "ç½©æ¯",
                allCupSizes: "æ‰€æœ‰ç½©æ¯",
                searchButton: "æœç´¢å¥³ä¼˜",
                noResults: "æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„å¥³ä¼˜ã€‚",
                detailNationality: "å›½ç±",
                detailAge: "å²", 
                detailCupSize: "ç½©æ¯",
                detailDescription: "ç®€ä»‹",
                detailDetailedInfo: "è¯¦ç»†èµ„æ–™",
                detailWikipedia: "ç»´åŸºç™¾ç§‘",
                viewMore: "ç‚¹å‡»æŸ¥çœ‹æ›´å¤š",
                viewVideo: "ç‚¹å‡»è§‚çœ‹å½±ç‰‡",
                close: "Ã—",
                adminPanel: "æ·»åŠ å¥³ä¼˜",
                mainSite: "ä¸»ç½‘ç«™",
                addActress: "æ–°å¢å¥³ä¼˜",
                editActress: "ç¼–è¾‘å¥³ä¼˜",
                actressName: "å¥³ä¼˜å§“å",
                actressNameZhTw: "å¥³å„ªå§“å (ç¹é«”ä¸­æ–‡)",
                actressNameZhCn: "å¥³ä¼˜å§“å (ç®€ä½“ä¸­æ–‡)",
                actressNameEn: "å¥³ä¼˜å§“å (è‹±æ–‡)",
                actressNameJa: "å¥³ä¼˜å§“å (æ—¥æ–‡)",
                birthDate: "å‡ºç”Ÿæ—¥æœŸ (YYYY-MM-DD)",
                mediaURL: "å½±ç‰‡URL (é™YouTubeæˆ–Googleäº‘ç«¯ç¡¬ç›˜)",
                recommendedVideoURL: "æ¨èå½±ç‰‡URL",
                add: "æ–°å¢",
                save: "ä¿å­˜",
                manageActresses: "ç®¡ç†å¥³ä¼˜èµ„æ–™",
                edit: "ç¼–è¾‘",
                delete: "åˆ é™¤",
                confirmDelete: "ç¡®å®šè¦åˆ é™¤è¿™ç¬”èµ„æ–™å—ï¼Ÿ",
                dataSaved: "èµ„æ–™å·²ä¿å­˜ï¼",
                dataDeleted: "èµ„æ–™å·²åˆ é™¤ï¼",
                dataError: "æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚",
                unknown: "æœªçŸ¥",
                confirmTitle: "ç¡®è®¤åˆ é™¤",
                confirmMessageText: "æ‚¨ç¡®å®šè¦åˆ é™¤è¿™ç¬”å¥³ä¼˜èµ„æ–™å—ï¼Ÿ",
                ageLabelText: "å¹´é¾„",
                invalidMedia: "æ— æ•ˆå½±ç‰‡URLæˆ–æ— æ³•åŠ è½½ (è¯·ç¡®è®¤æ˜¯å…¬å¼€/éå…¬å¼€YouTubeæˆ–Googleäº‘ç«¯ç¡¬ç›˜é“¾æ¥)",
                mediaPreviewHint: "ç²˜è´´YouTubeå½±ç‰‡URLåå°†åœ¨æ­¤æ˜¾ç¤ºé¢„è§ˆ (ä»…æ”¯æŒå…¬å¼€/éå…¬å¼€å½±ç‰‡)",
                videoLinkHint: "ç²˜è´´å½±ç‰‡URLåå°†åœ¨æ­¤æ˜¾ç¤ºé“¾æ¥æç¤º", 
                videoLinkGenerated: "å°†äº§ç”Ÿå¯ç‚¹å‡»çš„å½±ç‰‡é“¾æ¥", 
                recommendedVideo: "æ¨èå½±ç‰‡",
                hottestToday: "ä»Šæ—¥æœ€è¾£",
                newlyAdded: "æœ€æ–°ä¸Šçº¿",
                likesLabel: "åº”æ´æ•°",
                supportActress: "åº”æ´å¥³ä¼˜",
                supportMessage: "æ„Ÿè°¢æ‚¨çš„åº”æ´ï¼",
                oldDriverQuizTitle: "è€å¸æœºå°±æ˜¯æˆ‘",
                idealActressQuizTitle: "è°æ˜¯æˆ‘çš„ç†æƒ³å¥³ä¼˜ï¼Ÿ",
                backToMain: "è¿”å›ä¸»é¡µ",
                quizQuestionNum: "ç¬¬",
                quizQuestionText: "é¢˜",
                enterYourAnswer: "è¾“å…¥ä½ çš„ç­”æ¡ˆ",
                nextQuestion: "ä¸‹ä¸€é¢˜",
                finishQuiz: "å®Œæˆ",
                congratulations: "æ­å–œï¼",
                watchSpecialVideo: "è§‚çœ‹ç‰¹æ®Šå½±ç‰‡",
                failedQuiz: "æŠ±æ­‰ï¼Œæ‚¨æ²¡æœ‰å…¨éƒ¨ç­”å¯¹ã€‚",
                tryAgain: "å†è¯•ä¸€æ¬¡",
                yourScore: "ä½ çš„åˆ†æ•°",
                question: "é—®é¢˜",
                correctAnswer: "æ­£ç¡®ç­”æ¡ˆ",
                commentsSectionTitle: "ç½‘å‹ç•™è¨€åŒº",
                commentPlaceholder: "è¾“å…¥æ‚¨çš„ç•™è¨€...",
                commentButton: "ç•™è¨€",
                anonymousUser: "åŒ¿åç”¨æˆ·",
            },
            'en': {
                appName: "AVNY.com",
                appSubtitle: "Global AV Actress Information Search Platform",
                searchName: "Actress Name",
                inputPlaceholder: "Enter actress name",
                nationality: "Nationality",
                allNationalities: "All Nationalities",
                japan: "Japan",
                europe: "Western",
                korea: "Korea",
                china: "China",
                ageGroup: "Age Group",
                allAges: "All Ages",
                cupSize: "Cup Size",
                allCupSizes: "All Cup Sizes",
                searchButton: "Search Actresses",
                noResults: "No actresses found matching the criteria.",
                detailNationality: "Nationality",
                detailAge: "Years Old", 
                detailCupSize: "Cup Size",
                detailDescription: "Biography",
                detailDetailedInfo: "Detailed Information",
                detailWikipedia: "Wikipedia",
                viewMore: "Click for more",
                viewVideo: "Click to watch video",
                close: "Ã—",
                adminPanel: "Add Actress",
                mainSite: "Main Site",
                addActress: "Add Actress",
                editActress: "Edit Actress",
                actressName: "Actress Name",
                actressNameZhTw: "Actress Name (Traditional Chinese)",
                actressNameZhCn: "Actress Name (Simplified Chinese)",
                actressNameEn: "Actress Name (English)",
                actressNameJa: "Actress Name (Japanese)",
                birthDate: "Birth Date (YYYY-MM-DD)",
                mediaURL: "Video URL (YouTube or Google Drive)",
                recommendedVideoURL: "Recommended Video URL",
                add: "Add",
                save: "Save",
                manageActresses: "Manage Actresses",
                edit: "Edit",
                delete: "Delete",
                confirmDelete: "Are you sure you want to delete this entry?",
                dataSaved: "Data saved!",
                dataDeleted: "Data deleted!",
                dataError: "Operation failed, please try again later.",
                unknown: "Unknown",
                confirmTitle: "Confirm Delete",
                confirmMessageText: "Are you sure you want to delete this actress's data?",
                ageLabelText: "Age",
                invalidMedia: "Invalid video URL or failed to load (ensure it's a public/unlisted YouTube or Google Drive link)",
                mediaPreviewHint: "Paste YouTube video URL for preview (only public/unlisted videos supported)",
                videoLinkHint: "Paste video URL to display link hint here", 
                videoLinkGenerated: "A clickable video link will be generated", 
                recommendedVideo: "Recommended Video",
                hottestToday: "Today's Hottest",
                newlyAdded: "Newly Added",
                likesLabel: "Likes",
                supportActress: "Support Actress",
                supportMessage: "Thank you for your support!",
                oldDriverQuizTitle: "Old Driver Is Me",
                idealActressQuizTitle: "Who is My Ideal Actress?",
                backToMain: "Back to Main",
                quizQuestionNum: "Question ",
                quizQuestionText: "",
                enterYourAnswer: "Enter your answer",
                nextQuestion: "Next Question",
                finishQuiz: "Finish Quiz",
                congratulations: "Congratulations!",
                watchSpecialVideo: "Watch Special Video",
                failedQuiz: "Sorry, you didn't get all questions correct.",
                tryAgain: "Try Again",
                yourScore: "Your Score",
                question: "Question",
                correctAnswer: "Correct Answer",
                commentsSectionTitle: "User Comments",
                commentPlaceholder: "Enter your comment...",
                commentButton: "Comment",
                anonymousUser: "Anonymous User",
            },
            'ja': {
                appName: "AVNY.com",
                appSubtitle: "ä¸–ç•Œã®AVå¥³å„ªæƒ…å ±æ¤œç´¢ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ",
                searchName: "å¥³å„ªå",
                inputPlaceholder: "å¥³å„ªåã‚’å…¥åŠ›",
                nationality: "å›½ç±",
                allNationalities: "å…¨ã¦ã®å›½ç±",
                japan: "æ—¥æœ¬",
                europe: "æ­ç±³",
                korea: "éŸ“å›½",
                china: "ä¸­å›½",
                ageGroup: "å¹´é½¢å±¤",
                allAges: "å…¨ã¦ã®å¹´é½¢",
                cupSize: "ã‚«ãƒƒãƒ—ã‚µã‚¤ã‚º",
                allCupSizes: "å…¨ã¦ã®ã‚«ãƒƒãƒ—ã‚µã‚¤ã‚º",
                searchButton: "å¥³å„ªã‚’æ¤œç´¢",
                noResults: "æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹å¥³å„ªã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚",
                detailNationality: "å›½ç±",
                detailAge: "æ­³", 
                detailCupSize: "ã‚«ãƒƒãƒ—ã‚µã‚¤ã‚º",
                detailDescription: "ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«",
                detailDetailedInfo: "è©³ç´°æƒ…å ±",
                detailWikipedia: "ã‚¦ã‚£ã‚­ãƒšãƒ‡ã‚£ã‚¢",
                viewMore: "è©³ç´°ã¯ã“ã¡ã‚‰",
                viewVideo: "å‹•ç”»ã‚’è¦‹ã‚‹",
                close: "Ã—",
                adminPanel: "å¥³å„ªã‚’è¿½åŠ ",
                mainSite: "ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ãƒˆ",
                addActress: "å¥³å„ªã‚’è¿½åŠ ",
                editActress: "å¥³å„ªã‚’ç·¨é›†",
                actressName: "å¥³å„ªå",
                actressNameZhTw: "å¥³å„ªå§“å (ç¹é«”ä¸­æ–‡)",
                actressNameZhCn: "å¥³å„ªå§“å (ç°¡é«”ä¸­æ–‡)",
                actressNameEn: "å¥³å„ªå§“å (è‹±æ–‡)",
                actressNameJa: "å¥³å„ªå§“å (æ—¥æœ¬èª)",
                birthDate: "ç”Ÿå¹´æœˆæ—¥ (YYYY-MM-DD)",
                mediaURL: "å‹•ç”»URL (YouTubeã¾ãŸã¯Googleãƒ‰ãƒ©ã‚¤ãƒ–)",
                recommendedVideoURL: "ãŠã™ã™ã‚å‹•ç”»URL",
                add: "è¿½åŠ ",
                save: "ä¿å­˜",
                manageActresses: "å¥³å„ªã‚’ç®¡ç†",
                edit: "ç·¨é›†",
                delete: "å‰Šé™¤",
                confirmDelete: "ã“ã®ã‚¨ãƒ³ãƒˆãƒªã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ",
                dataSaved: "ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œã¾ã—ãŸï¼",
                dataDeleted: "ãƒ‡ãƒ¼ã‚¿ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸï¼",
                dataError: "æ“ä½œã«å¤±æ•—ã—ã¾ã—ãŸã€‚å¾Œã§ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚",
                unknown: "ä¸æ˜",
                confirmTitle: "å‰Šé™¤ã®ç¢ºèª",
                confirmMessageText: "ã“ã®å¥³å„ªãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ",
                ageLabelText: "å¹´é½¢",
                invalidMedia: "ç„¡åŠ¹ãªå‹•ç”»URLã¾ãŸã¯èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ (å…¬é–‹/é™å®šå…¬é–‹YouTubeã¾ãŸã¯Googleãƒ‰ãƒ©ã‚¤ãƒ–ã®ãƒªãƒ³ã‚¯ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„)",
                mediaPreviewHint: "YouTubeå‹•ç”»URLã‚’è²¼ã‚Šä»˜ã‘ã‚‹ã¨ã“ã“ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ (å…¬é–‹/é™å®šå…¬é–‹å‹•ç”»ã®ã¿å¯¾å¿œ)",
                videoLinkHint: "å‹•ç”»URLã‚’è²¼ã‚Šä»˜ã‘ã‚‹ã¨ã“ã“ã«ãƒªãƒ³ã‚¯ã®ãƒ’ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™", 
                videoLinkGenerated: "ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ãªå‹•ç”»ãƒªãƒ³ã‚¯ãŒç”Ÿæˆã•ã‚Œã¾ã™", 
                recommendedVideo: "ãŠã™ã™ã‚å‹•ç”»",
                hottestToday: "ä»Šæ—¥ã®äººæ°—",
                newlyAdded: "æ–°ç€",
                likesLabel: "å¿œæ´æ•°",
                supportActress: "å¥³å„ªã‚’å¿œæ´",
                supportMessage: "å¿œæ´ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼",
                oldDriverQuizTitle: "è€å¸ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¯ç§",
                idealActressQuizTitle: "ç§ã®ç†æƒ³ã®å¥³å„ªã¯èª°ï¼Ÿ",
                backToMain: "ãƒ¡ã‚¤ãƒ³ã«æˆ»ã‚‹",
                quizQuestionNum: "å•é¡Œ",
                quizQuestionText: "",
                enterYourAnswer: "å›ç­”ã‚’å…¥åŠ›",
                nextQuestion: "æ¬¡ã®è³ªå•",
                finishQuiz: "ã‚¯ã‚¤ã‚ºã‚’çµ‚äº†",
                congratulations: "ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼",
                watchSpecialVideo: "ã‚¹ãƒšã‚·ãƒ£ãƒ«ãƒ“ãƒ‡ã‚ªã‚’è¦–è´",
                failedQuiz: "æ®‹å¿µã€å…¨å•æ­£è§£ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚",
                tryAgain: "ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦",
                yourScore: "ã‚ãªãŸã®ã‚¹ã‚³ã‚¢",
                question: "å•é¡Œ",
                correctAnswer: "æ­£è§£",
                commentsSectionTitle: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆ",
                commentPlaceholder: "ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›...",
                commentButton: "ã‚³ãƒ¡ãƒ³ãƒˆ",
                anonymousUser: "åŒ¿åãƒ¦ãƒ¼ã‚¶ãƒ¼",
            }
        };

        let currentLang = localStorage.getItem('lang') || 'zh-TW'; // é è¨­èªè¨€ç‚ºç¹é«”ä¸­æ–‡

        function showMessage(message, isError = false) {
            messageBox.textContent = message;
            messageBox.className = 'message-box ' + (isError ? 'error' : '');
            messageBox.style.display = 'block';
            setTimeout(() => {
                messageBox.style.display = 'none';
            }, 3000);
        }

        // é¡¯ç¤ºè‡ªè¨‚ç¢ºèªå°è©±æ¡†
        function showConfirmDialog(message, onConfirmCallback) {
            confirmMessage.textContent = message;
            currentConfirmCallback = onConfirmCallback;
            confirmDialog.classList.remove('hidden');
        }

        // éš±è—è‡ªè¨‚ç¢ºèªå°è©±æ¡†
        function hideConfirmDialog() {
            confirmDialog.classList.add('hidden');
            currentConfirmCallback = null;
        }

        // ç¢ºèªæŒ‰éˆ•äº‹ä»¶
        confirmYesButton.addEventListener('click', () => {
            if (currentConfirmCallback) {
                currentConfirmCallback(true);
            }
            hideConfirmDialog();
        });

        // å–æ¶ˆæŒ‰éˆ•äº‹ä»¶
        confirmNoButton.addEventListener('click', () => {
            if (currentConfirmCallback) {
                currentConfirmCallback(false);
            }
            hideConfirmDialog();
        });


        // æ‡‰ç”¨ç¿»è­¯
        function applyTranslations() {
            const t = translations[currentLang];
            document.getElementById('appTitle').textContent = t.appName;
            document.getElementById('appName').textContent = t.appName;
            document.getElementById('appSubtitle').textContent = t.appSubtitle;
            document.getElementById('nameSearchLabel').textContent = t.searchName;
            document.getElementById('nameSearch').placeholder = t.inputPlaceholder;
            document.getElementById('nationalityFilterLabel').textContent = t.nationality;
            document.getElementById('allNationalitiesOption').textContent = t.allNationalities;
            document.getElementById('japanNationalityOption').textContent = t.japan;
            document.getElementById('europeNationalityOption').textContent = t.europe;
            document.getElementById('koreaNationalityOption').textContent = t.korea;
            document.getElementById('chinaNationalityOption').textContent = t.china;
            document.getElementById('ageFilterLabel').textContent = t.ageGroup;
            document.getElementById('allAgesOption').textContent = t.allAges;
            document.getElementById('cupSizeFilterLabel').textContent = t.cupSize;
            document.getElementById('allCupSizesOption').textContent = t.allCupSizes;
            document.getElementById('searchButton').textContent = t.searchButton;

            // Modal translations
            document.getElementById('detailNationalityLabel').textContent = t.detailNationality + 'ï¼š';
            document.getElementById('detailAgeLabel').textContent = t.ageLabelText + 'ï¼š';
            document.getElementById('detailCupSizeLabel').textContent = t.detailCupSize + 'ï¼š';
            document.getElementById('detailDescriptionLabel').textContent = t.detailDescription + 'ï¼š';
            document.getElementById('detailDetailedInfoLabel').textContent = t.detailDetailedInfo + 'ï¼š';
            document.getElementById('detailWikipediaLink').querySelector('strong').textContent = t.detailWikipedia + 'ï¼š';
            document.getElementById('detailWikipediaLink').querySelector('a').textContent = t.viewMore;
            document.getElementById('detailRecommendedVideoLabel').textContent = t.recommendedVideo + 'ï¼š'; 
            document.getElementById('detailRecommendedVideoLink').textContent = t.viewVideo; 
            closeModalButton.innerHTML = t.close;
            document.getElementById('detailLikesLabel').textContent = t.likesLabel + 'ï¼š';
            supportActressText.textContent = t.supportActress;

            // Admin panel translations
            toggleAdminButton.textContent = adminPanelVisible ? t.mainSite : t.adminPanel;
            document.getElementById('addActressHeader').textContent = editingActressId ? t.editActress : t.addActress;
            // Update multi-language name labels
            document.querySelector('label[for="actressNameZhTw"]').textContent = t.actressNameZhTw;
            document.querySelector('label[for="actressNameZhCn"]').textContent = t.actressNameZhCn;
            document.querySelector('label[for="actressNameEn"]').textContent = t.actressNameEn;
            document.querySelector('label[for="actressNameJa"]').textContent = t.actressNameJa;

            document.getElementById('nationalityLabelAdmin').textContent = t.nationality;
            document.getElementById('birthDateLabel').textContent = t.birthDate;
            document.getElementById('cupSizeLabelAdmin').textContent = t.cupSize;
            document.getElementById('descriptionLabelAdmin').textContent = t.description; // æ–°å¢
            document.getElementById('detailedInfoLabelAdmin').textContent = t.detailedInfo; // æ–°å¢
            document.getElementById('mediaUrlLabel').textContent = t.mediaURL; // Updated label for media
            document.getElementById('recommendedVideoUrlLabel').textContent = t.recommendedVideoURL; 
            document.getElementById('wikipediaLinkLabelAdmin').textContent = t.detailWikipedia + 'é€£çµ';
            addEditActressButton.textContent = editingActressId ? t.save : t.add;
            document.getElementById('manageActressesHeader').textContent = t.manageActresses;
            noMediaPreviewText.textContent = actressMediaUrlInput.value.trim() ? '' : t.mediaPreviewHint; // Use mediaPreviewHint
            videoLinkPreviewText.textContent = actressRecommendedVideoUrlInput.value.trim() ? t.videoLinkGenerated : t.videoLinkHint;

            // New section titles
            hottestTitle.textContent = t.hottestToday;
            newlyAddedTitle.textContent = t.newlyAdded;

            // Custom Confirmation Modal translations
            confirmYesButton.textContent = translations[currentLang].confirmYes || 'æ˜¯';
            confirmNoButton.textContent = translations[currentLang].confirmNo || 'å¦';

            // Quiz translations
            showQuizButton.textContent = t.oldDriverQuizTitle; // Use new title
            idealActressQuizTitle.textContent = t.idealActressQuizTitle; // Set new quiz title
            showIdealActressQuizButton.textContent = t.idealActressQuizTitle; // Set new button title

            backToMainFromQuizButton.textContent = t.backToMain;
            backToMainFromIdealQuizButton.textContent = t.backToMain; // New quiz back button

            quizTitle.textContent = t.oldDriverQuizTitle; // Use new title for the quiz panel
            quizQuestionElement.placeholder = t.enterYourAnswer; // This should be quizInput placeholder
            quizInput.placeholder = t.enterYourAnswer;
            nextQuestionButton.textContent = t.nextQuestion;
            submitQuizButton.textContent = t.finishQuiz;
            viewSpecialVideoButton.textContent = t.watchSpecialVideo;
            tryAgainButton.textContent = t.tryAgain;
            idealActressTryAgainButton.textContent = t.tryAgain; // New quiz try again

            // Comments section translations
            commentsTitle.textContent = t.commentsSectionTitle;
            commentTextarea.placeholder = t.commentPlaceholder;
            submitCommentButton.textContent = t.commentButton;

            // Update current question text if quiz is active
            if (quizPanel.classList.contains('active-quiz') && quizQuestions.length > 0) {
                displayQuestion(); // Re-render current question with updated language
            }
            // Update ideal actress quiz question if active
            if (idealActressQuizPanel.classList.contains('active-quiz') && idealActressQuizQuestions.length > 0) {
                displayIdealActressQuestion();
            }
        }

        // è¨­å®šèªè¨€
        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);
            applyTranslations();
            // Re-render main content
            performSearch(); // é‡æ–°æ¸²æŸ“æœå°‹çµæœä»¥æ‡‰ç”¨æ–°èªè¨€
            if (adminPanelVisible) {
                renderAdminActressList(); // é‡æ–°æ¸²æŸ“ç®¡ç†åˆ—è¡¨
            }
            renderHomepageSections(); // Also re-render homepage sections with new language names
            languageDropdownMenu.classList.add('hidden'); // Close dropdown after selection
        }

        // èªè¨€åˆ‡æ›ä¸‹æ‹‰é¸å–®ç”Ÿæˆ
        function setupLanguageSwitcher() {
            languageDropdownMenu.innerHTML = ''; // Clear previous options
            Object.keys(translations).forEach(langCode => {
                const button = document.createElement('button');
                button.textContent = langCode.toUpperCase();
                button.classList.add('language-option');
                if (langCode === currentLang) {
                    button.classList.add('active');
                }
                button.addEventListener('click', () => setLanguage(langCode));
                languageDropdownMenu.appendChild(button);
            });

            languageDropdownButton.addEventListener('click', (event) => {
                languageDropdownMenu.classList.toggle('hidden');
                event.stopPropagation(); // Prevent document click from immediately closing it
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', (event) => {
                if (!languageDropdownMenu.contains(event.target) && event.target !== languageDropdownButton) {
                    languageDropdownMenu.classList.add('hidden');
                }
            });
        }

        let allActresses = []; // å„²å­˜å¾ Firestore ç²å–çš„æ‰€æœ‰å¥³å„ªè³‡æ–™

        // è¨­å®š Firestore è³‡æ–™ç›£è½å™¨
        async function setupFirestoreListeners() {
            if (!isAuthReady) {
                console.warn("Auth not ready for Firestore listeners.");
                return;
            }
            if (!actressesCollection) {
                console.error("Firestore collection not initialized.");
                return;
            }

            // é¦–æ¬¡è¼‰å…¥æ™‚æª¢æŸ¥è³‡æ–™åº«æ˜¯å¦ç‚ºç©ºï¼Œè‹¥ç©ºå‰‡å¡«å……åˆå§‹è³‡æ–™
            const initialDocs = await getDocs(actressesCollection);
            if (initialDocs.empty) {
                console.log("Database is empty. Populating initial data...");
                await addInitialActressesToFirestore(); // å‘¼å«å¡«å……å‡½æ•¸
            }

            // è¨­å®šå¯¦æ™‚ç›£è½å™¨
            onSnapshot(actressesCollection, (snapshot) => {
                const fetchedActresses = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    // Ensure totalClicks and createdAt have default values if not present
                    fetchedActresses.push({ 
                        id: doc.id, 
                        // Assign default empty strings to new name fields if they don't exist
                        name_zh_TW: data.name_zh_TW || data.name || '', // Use original 'name' as fallback for zh_TW
                        name_zh_CN: data.name_zh_CN || '',
                        name_en: data.name_en || '',
                        name_ja: data.name_ja || '',
                        ...data, // Keep existing fields, let new name fields override 'name'
                        totalClicks: data.totalClicks || 0, // Default to 0 clicks
                        likes: data.likes || 0, // Default to 0 likes
                        createdAt: data.createdAt || new Date().toISOString() // Default to current time if not set
                    });
                });

                // Client-side deduplication by name (using zh_TW for uniqueness)
                const uniqueActressesMap = new Map();
                fetchedActresses.forEach(actress => {
                    if (actress.name_zh_TW) { // Ensure primary name exists
                        uniqueActressesMap.set(actress.name_zh_TW, actress);
                    }
                });
                allActresses = Array.from(uniqueActressesMap.values());

                console.log("Actresses data updated from Firestore and deduplicated:", allActresses);

                // åˆ·æ–°ä¸»ç¶²ç«™æœå°‹çµæœå’Œå¾Œå°ç®¡ç†åˆ—è¡¨
                performSearch();
                renderHomepageSections(); // Render new sections after data update
                if (adminPanelVisible) {
                    renderAdminActressList();
                }
            }, (error) => {
                console.error("Error listening to Firestore:", error);
                showMessage(translations[currentLang].dataError, true);
            });
        }

        // æª¢æŸ¥URLæ˜¯å¦ç‚ºYouTubeå½±ç‰‡é€£çµ
        function isYouTubeUrl(url) {
            if (!url) return false;
            // Robust regex to capture various YouTube formats including Shorts
            const youtubeRegex = /^(https?:\/\/)?(www\.)?(m\.)?(youtube\.com|youtu\.be)\/(?:watch\?v=|embed\/|v\/|shorts\/|)([\w-]{11})(?:\S+)?$/;
            return youtubeRegex.test(url);
        }

        // å¾YouTubeå½±ç‰‡URLä¸­æå–å½±ç‰‡ID
        function getYouTubeVideoId(url) {
            let videoId = '';
            // Robust regex to extract video ID from various YouTube formats including Shorts
            const youtubeRegex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/|youtube\.com\/shorts\/)([^"&?\/\s]{11})/i;
            const match = url.match(youtubeRegex);
            if (match && match[1]) {
                videoId = match[1];
            }
            return videoId;
        }

        // æ§‹é€ YouTubeåµŒå…¥å¼URL
        function getYouTubeEmbedUrl(url, autoplay = 0, loop = 0, muted = 0, controls = 1) {
            const videoId = getYouTubeVideoId(url);
            if (!videoId) return '';
            let embedUrl = `https://www.youtube.com/embed/${videoId}?`;
            embedUrl += `autoplay=${autoplay}`;
            embedUrl += `&mute=${muted}`;
            embedUrl += `&loop=${loop}`;
            if (loop) { // loop requires playlist parameter for single video
                embedUrl += `&playlist=${videoId}`;
            }
            embedUrl += `&controls=${controls}`;
            embedUrl += `&playsinline=1`; // Important for mobile devices to play inline
            embedUrl += `&enablejsapi=1`; // Enable JS API for more control if needed
            embedUrl += `&modestbranding=1`; // Reduced YouTube branding
            return embedUrl;
        }

        // æª¢æŸ¥URLæ˜¯å¦ç‚ºæ³›å‹å½±ç‰‡ï¼ˆMP4ã€Google Driveç­‰ï¼ŒéYouTubeï¼‰
        function isGenericVideoUrl(url) {
            if (!url) return false;
            const lowerCaseUrl = url.toLowerCase();
            const videoExtensions = ['.mp4', '.webm', '.ogg', '.mov', '.avi', '.mkv'];
            // Check for common video file extensions directly in the URL
            if (videoExtensions.some(ext => lowerCaseUrl.includes(ext))) {
                return true;
            }
            // Check for Google Drive video links (publicly shared)
            if (lowerCaseUrl.includes('drive.google.com/file/d/') || lowerCaseUrl.includes('drive.google.com/open?id=')) {
                return true;
            }
            return false;
        }

        // å¾Google Driveåˆ†äº«é€£çµä¸­æå–æª”æ¡ˆID
        function getGoogleDriveFileId(url) {
            const match = url.match(/(?:id=|file\/d\/)([^/&?#]+)/);
            return match ? match[1] : null;
        }

        // æ§‹é€  Google Drive ç›´æ¥ä¸‹è¼‰/æ’­æ”¾é€£çµ
        function getGoogleDriveDirectLink(url) {
            const fileId = getGoogleDriveFileId(url);
            if (fileId) {
                return `https://drive.google.com/uc?export=download&id=${fileId}`;
            }
            return url;
        }

        // æª¢æŸ¥URLæ˜¯å¦ç‚ºGoogleé›²ç«¯ç¡¬ç¢Ÿåœ–ç‰‡é€£çµ
        function isGoogleDriveImageUrl(url) {
            return url && url.includes('drive.google.com');
        }

        // æ§‹é€  Google é›²ç«¯ç¡¬ç¢Ÿåœ–ç‰‡ç›´æ¥é€£çµ
        function getGoogleDriveImageSrc(url) {
            const fileId = getGoogleDriveFileId(url);
            if (fileId) {
                // 'export=view' is generally better for direct embedding images
                return `https://drive.google.com/uc?export=view&id=${fileId}`;
            }
            return url;
        }

        // åˆå§‹è³‡æ–™å¡«å……å‡½æ•¸ (åªæœƒåœ¨è³‡æ–™åº«ç‚ºç©ºæ™‚åŸ·è¡Œ)
        async function addInitialActressesToFirestore() {
            const initialData = [
                {
                    name_zh_TW: "æ–°æœ‰èœ", name_zh_CN: "æ–°æœ‰èœ", name_en: "Arina Arina", name_ja: "æ–°æœ‰èœ", nationality: "æ—¥æœ¬", birthDate: "1996-12-15", cupSize: "C", description: "", detailedInfo: "", wikipediaLink: "https://zh.wikipedia.org/zh-tw/%E6%96%B0%E6%9C%89%E8%8F%9C",
                    mediaUrl: "https://www.youtube.com/watch?v=k_jH56l3u1w", // YouTube example
                    recommendedVideoUrl: "https://www.youtube.com/watch?v=dQw4w9WgXcQ", // Example YouTube URL
                    likes: 0
                },
                {
                    name_zh_TW: "æœ¬åº„éˆ´", name_zh_CN: "æœ¬åº„é“ƒ", name_en: "Suzu Honjo", name_ja: "æœ¬åº„éˆ´", nationality: "æ—¥æœ¬", birthDate: "1997-01-12", cupSize: "C", description: "", detailedInfo: "", wikipediaLink: "https://zh.wikipedia.org/zh-tw/%E6%9C%AC%E5%BA%84%E9%88%B4",
                    mediaUrl: "https://www.youtube.com/shorts/8ZQL8g0hK5k", // UPDATED: æœ¬åº„éˆ´ Shorts URL
                    recommendedVideoUrl: "https://www.jable.tv/videos/some-jable-video-id/", // Example Jable URL
                    likes: 0
                },
                {
                    name_zh_TW: "ä¸ƒæ¾¤ç±³äº", name_zh_CN: "ä¸ƒæ³½ç±³äºš", name_en: "Mia Nanasawa", name_ja: "ä¸ƒæ¾¤ãƒŸã‚¢", nationality: "æ—¥æœ¬", birthDate: "1998-12-13", cupSize: "C", description: "", detailedInfo: "", wikipediaLink: "https://zh.wikipedia.org/zh-tw/%E4%B8%83%E6%BE%A4%E7%B1%B3%E4%BA%9E",
                    mediaUrl: "https://www.youtube.com/shorts/XMjGpX6luoU", // UPDATED: ä¸ƒæ¾¤ç±³äº Shorts URL
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "ä¸‰ä¸Šæ‚ äº", name_zh_CN: "ä¸‰ä¸Šæ‚ äºš", name_en: "Yua Mikami", name_ja: "ä¸‰ä¸Šæ‚ äºœ", nationality: "æ—¥æœ¬", birthDate: "1993-08-16", cupSize: "G", description: "æ¸¬è©¦å½±ç‰‡æ’­æ”¾", detailedInfo: "é€™æ˜¯ä¸€å€‹æ¸¬è©¦ç”¨çš„çŸ­å½±ç‰‡ç¯„ä¾‹ï¼Œè«‹ç¢ºä¿å½±ç‰‡æª”æ¡ˆå°æ–¼10MBï¼Œæ’­æ”¾æ™‚é–“å°æ–¼10ç§’ã€‚", wikipediaLink: "https://zh.wikipedia.org/zh-tw/%E4%B8%89%E4%B8%8A%E6%82%A0%E4%BA%9E",
                    mediaUrl: "https://www.youtube.com/shorts/mE11KY54mxk", // UPDATED: ä¸‰ä¸Šæ‚ äº Shorts URL from user query
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "æ²³åŒ—å½©ä¼½", name_zh_CN: "æ²³åŒ—å½©ä¼½", name_en: "Saika Kawakita", name_ja: "æ²³åŒ—å½©ä¼½", nationality: "æ—¥æœ¬", birthDate: "1999-04-24", cupSize: "E", description: "", detailedInfo: "", wikipediaLink: "https://zh.wikipedia.org/zh-tw/%E6%B2%B3%E5%8C%97%E5%BD%A9%E4%BC%BD",
                    mediaUrl: "https://www.youtube.com/watch?v=k_jH56l3u1w", // YouTube example
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "å®®ä¸‹éˆ´å¥ˆ", name_zh_CN: "å®«ä¸‹é“ƒå¥ˆ", name_en: "Suzuna Miyashita", name_ja: "å®®ä¸‹éˆ´å¥ˆ", nationality: "æ—¥æœ¬", birthDate: "1997-05-01", cupSize: "C", description: "", detailedInfo: "", wikipediaLink: "https://zh.wikipedia.org/zh-tw/%E5%AE%AE%E4%B8%8B%E7%8E%B2%E5%A5%88",
                    mediaUrl: "https://www.youtube.com/shorts/2g81WQcR_z8", // YouTube Shorts example
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "èƒ¡æ¡ƒæ«»", name_zh_CN: "èƒ¡æ¡ƒæ¨±", name_en: "Kurumi Sakura", name_ja: "èƒ¡æ¡ƒæ¡œ", nationality: "æ—¥æœ¬", birthDate: "1995-12-25", cupSize: "D", description: "", detailedInfo: "", wikipediaLink: "https://japhub.com/?c=21040",
                    mediaUrl: "https://www.youtube.com/shorts/2RCkDumdfFU", // UPDATED: èƒ¡æ¡ƒæ«» Shorts URL
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "ç¨»å·å¤ç›®", name_zh_CN: "ç¨»å·å¤ç›®", name_en: "Natsume Inagawa", name_ja: "ç¨²å·å¤ç›®", nationality: "æ—¥æœ¬", birthDate: "1991-09-30", cupSize: "G", description: "", detailedInfo: "", wikipediaLink: "https://zh.wikipedia.org/zh-tw/%E7%A8%B2%E5%B7%9D%E5%A4%8F%E7%9B%AE",
                    mediaUrl: "https://www.youtube.com/watch?v=wXhTHyv-2sI", // YouTube example
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "ç¾è°·æœ±éŸ³", name_zh_CN: "ç¾è°·æœ±éŸ³", name_en: "Akane Maetani", name_ja: "ç¾è°·æœ±éŸ³", nationality: "æ—¥æœ¬", birthDate: "1998-04-19", cupSize: "H", description: "", detailedInfo: "", wikipediaLink: "https://zh.wikipedia.org/zh-tw/%E7%BE%8E%E8%B0%B7%E6%9C%B1%E9%9F%B3",
                    mediaUrl: "https://www.youtube.com/watch?v=k_jH56l3u1w", // YouTube example
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "ç¯ ç”°å„ª", name_zh_CN: "ç¯ ç”°ä¼˜", name_en: "Yu Shinoda", name_ja: "ç¯ ç”°ã‚†ã†", nationality: "æ—¥æœ¬", birthDate: "1991-06-28", cupSize: "G", description: "", detailedInfo: "", wikipediaLink: "https://zh.wikipedia.org/zh-tw/%E7%AF%A0%E7%94%B0%E4%BC%98",
                    mediaUrl: "https://www.youtube.com/shorts/nGP3e-thz0Q", // UPDATED: ç¯ ç”°å„ª Shorts URL
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "æ¡ƒä¹ƒæœ¨é¦™å¥ˆ", name_zh_CN: "æ¡ƒä¹ƒæœ¨é¦™å¥ˆ", name_en: "Kana Momonogi", name_ja: "æ¡ƒä¹ƒæœ¨ã‹ãª", nationality: "æ—¥æœ¬", birthDate: "1996-12-24", cupSize: "F", description: "", detailedInfo: "", wikipediaLink: "https://zh.wikipedia.org/zh-tw/%E6%A1%83%E4%B9%83%E6%9C%A8%E9%A6%99%E5%A5%88",
                    mediaUrl: "https://www.youtube.com/watch?v=QH2-TGUlwu4", // YouTube example
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "æ³¢å¤šé‡çµè¡£", name_zh_CN: "æ³¢å¤šé‡ç»“è¡£", name_en: "Yui Hatano", name_ja: "æ³¢å¤šé‡çµè¡£", nationality: "æ—¥æœ¬", birthDate: "1988-05-24", cupSize: "D", description: "", detailedInfo: "", wikipediaLink: "https://zh.wikipedia.org/zh-tw/%E6%B3%A2%E5%A4%9A%E9%87%8E%E7%B5%90%E8%A1%A3",
                    mediaUrl: "https://www.youtube.com/shorts/vbNkmqwB7zc", // UPDATED: æ³¢å¤šé‡çµè¡£ Shorts URL
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "çŸ³å·æ¾ª", name_zh_CN: "çŸ³å·æ¾ª", name_en: "Mio Ishikawa", name_ja: "çŸ³å·æ¾ª", nationality: "æ—¥æœ¬", birthDate: "2001-06-06", cupSize: "C", description: "", detailedInfo: "", wikipediaLink: "https://zh.wikipedia.org/zh-tw/%E7%9F%B3%E5%B7%9D%E6%BE%AA",
                    mediaUrl: "https://www.youtube.com/watch?v=k_jH56l3u1w", // YouTube example
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "å°å€‰ç”±èœ", name_zh_CN: "å°ä»“ç”±èœ", name_en: "Yuna Ogura", name_ja: "å°å€‰ç”±èœ", nationality: "æ—¥æœ¬", birthDate: "1998-11-05", cupSize: "D", description: "", detailedInfo: "", wikipediaLink: "https://zh.wikipedia.org/zh-tw/%E5%B0%8F%E5%80%89%E7%94%B1%E8%8F%9C",
                    mediaUrl: "https://www.youtube.com/shorts/2g81WQcR_z8", // YouTube Shorts example
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "ç´—å€‰çœŸèœ", name_zh_CN: "çº±ä»“çœŸèœ", name_en: "Mana Sakura", name_ja: "ç´—å€‰ã¾ãª", nationality: "æ—¥æœ¬", birthDate: "1993-03-23", cupSize: "E", description: "", detailedInfo: "", wikipediaLink: "https://zh.wikipedia.org/wiki/%E7%B4%97%E5%80%89%E7%9C%9F%E8%8F%9C",
                    mediaUrl: "https://www.youtube.com/watch?v=QH2-TGUlwu4", // YouTube example
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "å…«æ›æµ·", name_zh_CN: "å…«æŒ‚æµ·", name_en: "Kai Hachigame", name_ja: "å…«æ›æµ·", nationality: "æ—¥æœ¬", birthDate: "2000-09-02", cupSize: "A", description: "", detailedInfo: "", wikipediaLink: "https://zh.wikipedia.org/zh-tw/%E5%85%AB%E6%8E%9B%E6%B5%B7",
                    mediaUrl: "https://www.youtube.com/watch?v=wXhTHyv-2sI", // YouTube example
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "æ¶¼æ£®ç²å¤¢", name_zh_CN: "å‡‰æ£®ç²æ¢¦", name_en: "Remu Suzumori", name_ja: "æ¶¼æ£®ã‚Œã‚€", nationality: "æ—¥æœ¬", birthDate: "1998-11-10", cupSize: "F", description: "", detailedInfo: "", wikipediaLink: "https://zh.wikipedia.org/zh-tw/%E6%B6%BC%E6%A3%AE%E7%8E%B2%E5%A4%A2",
                    mediaUrl: "https://www.youtube.com/watch?v=k_jH56l3u1w", // YouTube example
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "æ«»ç©ºæ¡ƒ", name_zh_CN: "æ¨±ç©ºæ¡ƒ", name_en: "Momo Sakura", name_ja: "æ¡œç©ºã‚‚ã‚‚", nationality: "æ—¥æœ¬", birthDate: "1996-12-03", cupSize: "G", description: "", detailedInfo: "", wikipediaLink: "https://zh.wikipedia.org/zh-tw/%E6%A8%B1%E7%A9%BA%E6%A1%83",
                    mediaUrl: "https://www.youtube.com/shorts/2g81WQcR_z8", // YouTube Shorts example
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "å¤§æ§»éŸ¿", name_zh_CN: "å¤§æ§»å“", name_en: "Hibiki Otsuki", name_ja: "å¤§æ§»ã²ã³ã", birthDate: "1988-02-21", nationality: "æ—¥æœ¬", cupSize: "D", description: "", detailedInfo: "", wikipediaLink: "https://zh.wikipedia.org/zh-tw/%E5%A4%A7%E6%A7%BB%E9%9F%BF",
                    mediaUrl: "https://www.youtube.com/watch?v=QH2-TGUlwu4", // YouTube example
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "å‰é«˜å¯§å¯§", name_zh_CN: "å‰é«˜å®å®", name_en: "Nene Yoshitaka", name_ja: "å‰é«˜å¯§ã€…", nationality: "æ—¥æœ¬", birthDate: "1997-01-01", cupSize: "C", description: "", detailedInfo: "", wikipediaLink: "https://zh.wikipedia.org/zh-tw/%E5%90%89%E9%AB%98%E5%AE%81%E5%AE%81",
                    mediaUrl: "https://www.youtube.com/watch?v=wXhTHyv-2sI", // YouTube example
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "é£¯å³¶æ„›", name_zh_CN: "é¥­å²›çˆ±", name_en: "Ai Iijima", name_ja: "é£¯å³¶æ„›", nationality: "æ—¥æœ¬", birthDate: "1972-10-31", cupSize: "C", description: "", detailedInfo: "", wikipediaLink: "https://zh.wikipedia.org/zh-tw/%E9%A3% sorprendente%E6%84%9B",
                    mediaUrl: "https://www.youtube.com/watch?v=k_jH56l3u1w", // YouTube example
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "é€¢è¦‹æ¢¨èŠ±", name_zh_CN: "é€¢è§æ¢¨èŠ±", name_en: "Rika Aimi", name_ja: "é€¢è¦‹æ¢¨èŠ±", nationality: "æ—¥æœ¬", birthDate: "1992-07-18", cupSize: "E", description: "", detailedInfo: "", wikipediaLink: "https://zh.wikipedia.org/zh-tw/%E9%80%A4%E8%A6%8B%E6%A2%A8%E8%8A%B1",
                    mediaUrl: "https://www.youtube.com/shorts/2g81WQcR_z8", // YouTube Shorts example
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "ç¾å’²ä½³å¥ˆ", name_zh_CN: "ç¾å’²ä½³å¥ˆ", name_en: "Kana Misaki", name_ja: "ç¾å’²ã‹ãª", nationality: "æ—¥æœ¬", birthDate: "1997-01-20", cupSize: "C", description: "", detailedInfo: "", wikipediaLink: "https://baike.baidu.com/item/%E7%BE%8E%E5%92%B2%E4%BD%B3%E5%A5%88/18701244",
                    mediaUrl: "https://www.youtube.com/shorts/GrXA8yshBxE", // UPDATED: ç¾å’²ä½³å¥ˆ Shorts URL
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "æ©˜ç‘ªéº—", name_zh_CN: "æ©˜ç›ä¸½", name_en: "Marie Tachibana", name_ja: "æ©˜ãƒ¡ã‚¢ãƒªãƒ¼", nationality: "æ—¥æœ¬", birthDate: "1993-07-07", cupSize: "G", description: "", detailedInfo: "", wikipediaLink: "https://zh.wikipedia.org/zh-tw/%E6%A9%93%E7%91%AA%E9%BA%97",
                    mediaUrl: "https://www.youtube.com/watch?v=wXhTHyv-2sI", // YouTube example
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "ç¥æœ¨éº—", name_zh_CN: "ç¥æœ¨ä¸½", name_en: "Rei Kamiki", name_ja: "ç¥æœ¨éº—", nationality: "æ—¥æœ¬", birthDate: "1994-09-25", cupSize: "E", description: "", detailedInfo: "", wikipediaLink: "https://zh.wikipedia.org/zh-tw/%E7%A5%9E%E6%9C%A8%E9%BA%97",
                    mediaUrl: "https://www.youtube.com/shorts/LOkPFqdtRdw", // UPDATED: ç¥æœ¨éº— Shorts URL
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "æ°´é‡å„ªé¦™", name_zh_CN: "æ°´é‡ä¼˜é¦™", name_en: "Yuuka Mizuno", name_ja: "æ°´é‡å„ªé¦™", nationality: "æ—¥æœ¬", birthDate: "1999-02-14", cupSize: "D", description: "", detailedInfo: "", wikipediaLink: "https://ja.wikipedia.org/wiki/%E6%B0%B4%E9%87%8E%E5%84%AA%E9%A6%99",
                    mediaUrl: "https://www.youtube.com/shorts/2g81WQcR_z8", // YouTube Shorts example
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "ç™½æœ¨å„ªå­", name_zh_CN: "ç™½æœ¨ä¼˜å­", name_en: "Yuko Shiraki", name_ja: "ç™½æœ¨å„ªå­", nationality: "æ—¥æœ¬", birthDate: "1976-01-01", cupSize: "E", description: "", detailedInfo: "", wikipediaLink: "https://zh.wikipedia.org/wiki/%E7%99%BD%E6%9C%A8%E5%84%AA%E5%AD%90",
                    mediaUrl: "https://www.youtube.com/watch?v=QH2-TGUlwu4", // YouTube example
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "å¤§å³¶å„ªé¦™", name_zh_CN: "å¤§å²›ä¼˜é¦™", name_en: "Yuka Ohshima", name_ja: "å¤§å³¶å„ªé¦™", nationality: "æ—¥æœ¬", birthDate: "1993-10-10", cupSize: "F", description: "", detailedInfo: "", wikipediaLink: "https://zh.wikipedia.org/wiki/%E5%A4%A7%E5%B3%B6%E5%84%AA%E9%A6%99",
                    mediaUrl: "https://www.youtube.com/watch?v=wXhTHyv-2sI", // YouTube example
                    recommendedVideoUrl: "",
                    likes: 0
                },
                {
                    name_zh_TW: "æˆ¶ç”°çœŸç´", name_zh_CN: "æˆ·ç”°çœŸç´", name_en: "Makoto Toda", name_ja: "æˆ¸ç”°çœŸç´", nationality: "æ—¥æœ¬", birthDate: "1996-03-22", cupSize: "B", description: "æ¸¬è©¦å½±ç‰‡æ’­æ”¾ï¼Œé€™å€‹æ˜¯æ–°çš„çŸ­å½±ç‰‡ã€‚", detailedInfo: "å½±ç‰‡å¤§å°ç´„1MBï¼Œæ’­æ”¾æ™‚é–“ç´„10ç§’ã€‚", wikipediaLink: "https://zh.wikipedia.org/zh-tw/%E6%88%B7%E7%94%B0%E7%9C%9F%E7%90%B4",
                    mediaUrl: "https://www.w3schools.com/html/mov_bbb.mp4", // Generic MP4 example, will be played with <video> tag
                    recommendedVideoUrl: "",
                    likes: 0
                }
            ];

            try {
                for (const actress of initialData) {
                    // åœ¨æ·»åŠ å‰æª¢æŸ¥å¥³å„ªæ˜¯å¦å·²å­˜åœ¨
                    const q = query(actressesCollection, where("name_zh_TW", "==", actress.name_zh_TW)); // Check with zh_TW name
                    const existingDocs = await getDocs(q);

                    if (existingDocs.empty) {
                        await addDoc(actressesCollection, {
                            ...actress,
                            createdAt: new Date().toISOString(), // Set creation timestamp
                            totalClicks: 0, // Initialize clicks
                            likes: 0 // Initialize likes
                        });
                        console.log(`Added initial actress: ${actress.name_zh_TW}`);
                    } else {
                        console.log(`Actress ${actress.name_zh_TW} already exists, skipping initial population.`);
                        // Optional: If you want to ensure existing docs have 'likes' field, you can update them here.
                        // For simplicity, we rely on onSnapshot to handle missing fields with default values.
                    }
                }
                console.log("Initial data population check complete.");
            } catch (error) {
                console.error("Error populating initial data:", error);
                showMessage(translations[currentLang].dataError, true);
            }
        }

        // è¨ˆç®—å¹´é½¡
        function calculateAge(birthDateString) {
            if (!birthDateString) return translations[currentLang].unknown;
            const birthDate = new Date(birthDateString);
            const today = new Date();
            let age = today.getFullYear() - birthDate.getFullYear();
            const m = today.getMonth() - birthDate.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            return age;
        }

        // æ¸²æŸ“å¥³å„ªå¡ç‰‡
        function renderActressCard(actress, container) {
            const age = calculateAge(actress.birthDate);
            const actressName = getActressNameByLang(actress, currentLang); // Get localized name
            const actressCard = document.createElement('div');
            const baseClasses = "rounded-lg shadow-lg p-4 relative overflow-hidden transition transform hover:scale-105";
            const bgColor = actress.isLegend ? 'bg-yellow-400 text-black' : 'bg-gray-800 text-white';
            actressCard.className = 'actress-card p-4 rounded-lg shadow-md hover:shadow-xl transform hover:scale-105 transition duration-300 cursor-pointer border hover:border-red-600 hover:bg-gray-700 relative';
            if (actress.isLegend) {
                    actressCard.className = 'actress-card bg-gradient-to-br from-yellow-300 via-yellow-400 to-yellow-500 text-black p-4 rounded-lg shadow-md hover:shadow-xl transform hover:scale-105 transition duration-300 cursor-pointer border border-yellow-500';
                    const legendTag = document.createElement('div');
                    legendTag.textContent = 'LEGEND';
                    legendTag.className = 'absolute top-2 left-2 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded shadow';
                    actressCard.appendChild(legendTag);
            } else {
                actressCard.classList.add('bg-gray-900', 'text-white');
            }
            container.appendChild(actressCard);
            let mediaElementHtml = '';
            // Placeholder video if mediaUrl is missing or invalid
            const defaultYouTubePlaceholder = getYouTubeEmbedUrl("https://www.youtube.com/watch?v=dQw4w9WgXcQ", 1, 1, 1, 0); 

            if (actress.mediaUrl && isYouTubeUrl(actress.mediaUrl)) {
                // Autoplay, loop, muted, no controls for search results card
                const embedUrl = getYouTubeEmbedUrl(actress.mediaUrl, 1, 1, 1, 0); 
                mediaElementHtml = `
                    <div class="aspect-ratio-3-4">
                        <iframe src="${embedUrl}" 
                                frameborder="0" allow="autoplay; encrypted-media; gyroscope; picture-in-picture" 
                                allowfullscreen>
                        </iframe>
                    </div>
                `;
            } else if (actress.mediaUrl && isGenericVideoUrl(actress.mediaUrl)) {
                // For generic MP4 or Google Drive links, use <video> tag
                // Autoplay, loop, muted, no controls for search results card
                const genericVideoUrl = getGoogleDriveDirectLink(actress.mediaUrl);
                mediaElementHtml = `
                    <div class="aspect-ratio-3-4">
                        <video loop muted playsinline preload="metadata" autoplay>
                            <source src="${genericVideoUrl}" type="video/mp4">
                            ${translations[currentLang].invalidMedia}
                        </video>
                    </div>
                `;
            } else {
                // Fallback to a generic YouTube placeholder if URL is invalid or not provided
                mediaElementHtml = `
                    <div class="aspect-ratio-3-4">
                        <iframe src="${defaultYouTubePlaceholder}" 
                                frameborder="0" allow="autoplay; encrypted-media; gyroscope; picture-in-picture" 
                                allowfullscreen>
                        </iframe>
                    </div>
                `;
            }

            actressCard.innerHTML = `
                ${mediaElementHtml}
                <h3 class="text-white text-lg font-semibold text-center">${actressName} (${age}${translations[currentLang].detailAge})</h3>
                <div class="flex items-center justify-center mt-2">
                    <button class="like-btn text-gray-400 hover:text-red-500 transition duration-300" data-id="${actress.id}">
                        <i class="fas fa-heart text-2xl"></i>
                    </button>
                    <span id="likes-count-${actress.id}" class="text-white text-lg ml-2">${actress.likes || 0}</span>
                </div>
            `;
            // Attach event listener to the card (for opening modal)
            // Use delegation or attach directly to the card element for opening modal
            actressCard.addEventListener('click', (e) => {
                // Only open modal if click is not on the like button
                if (!e.target.closest('.like-btn')) {
                    openDetailModal(actress);
                }
            });

            // Attach event listener to the like button specifically
            actressCard.querySelector('.like-btn').addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent modal from opening when clicking the like button
                handleLikeClick(actress.id);
            });

            container.appendChild(actressCard);

            // Ensure videos start playing after they are added to DOM (mainly for non-YouTube <video> tags)
            actressCard.querySelectorAll('video').forEach(video => {
                video.play().catch(e => console.log("Video autoplay prevented in card:", e));
            });
        }


        // é¡¯ç¤ºæœå°‹çµæœ
        function displayResults(filteredActresses) {
            resultsSection.innerHTML = ''; // æ¸…ç©ºä¹‹å‰çš„çµæœ
            if (filteredActresses.length === 0) {
                resultsSection.innerHTML = `<p class="text-white text-center col-span-full text-lg mt-8">${translations[currentLang].noResults}</p>`;
                return;
            }

            filteredActresses.forEach(actress => {
                renderActressCard(actress, resultsSection);
            });
        }

        // é–‹å•Ÿå¥³å„ªè©³ç´°è³‡è¨Šå½ˆå‡ºè¦–çª—
        async function openDetailModal(actress) {
            // Increment totalClicks and update in Firestore
            console.log("âœ… å‘¼å« openDetailModalï¼Œæ”¶åˆ°å¥³å„ªè³‡æ–™å¦‚ä¸‹ï¼š", actress);
            console.log("ğŸ” description:", actress.description);
            console.log("ğŸ” detailedInfo:", actress.detailedInfo);
            try {
                const actressDocRef = doc(db, `artifacts/${appId}/public/data/actresses`, actress.id);
                const updatedClicks = (actress.totalClicks || 0) + 1;
                await updateDoc(actressDocRef, { totalClicks: updatedClicks });
                // Update local data immediately for responsive UI
                actress.totalClicks = updatedClicks; 
                console.log(`Actress ${getActressNameByLang(actress, currentLang)} clicks updated to ${updatedClicks}`);
            } catch (error) {
                console.error("Error updating click count:", error);
                showMessage(translations[currentLang].dataError, true);
            }
            
            const age = calculateAge(actress.birthDate);
            detailName.textContent = getActressNameByLang(actress, currentLang); // Get localized name for modal title
            detailNationality.textContent = actress.nationality || translations[currentLang].unknown;
            detailAge.textContent = `${age}${translations[currentLang].detailAge}`; 
            detailCupSize.textContent = actress.cupSize || translations[currentLang].unknown;
            detailDescription.textContent = actress.description || translations[currentLang].unknown;
            detailDetailedInfo.textContent = actress.detailedInfo || translations[currentLang].unknown;
            detailWikipediaLink.href = actress.wikipediaLink || '#';
            if (!actress.wikipediaLink || actress.wikipediaLink === '#') {
                detailWikipediaLink.classList.add('pointer-events-none', 'opacity-50');
            } else {
                detailWikipediaLink.classList.remove('pointer-events-none', 'opacity-50');
            }
            
            if (actress.isLegend) {
                    const legendAudio = new Audio("https://jiajun1208.github.io/AVNY.com/sounds/1750384961430710209-281936517574735.mp3");
                    legendAudio.volume = 0.7;
                    legendAudio.play().catch(err => console.warn("å‚³å¥‡éŸ³æ•ˆæ’­æ”¾å¤±æ•—ï¼š", err));
            }
            const modal = document.getElementById('actressDetailModal');
            if (actress.isLegend) {
                  modal.classList.add('dark-gold-metallic');
            } else {
                  modal.classList.remove('dark-gold-metallic');
            }
            
            // Update likes count in modal
            modalLikesCount.textContent = actress.likes || 0;
            detailLikeButton.dataset.id = actress.id; // Set the actress ID on the like button

            // Render media in modal with 3:4 aspect ratio
            detailMediaContainer.innerHTML = ''; // Clear previous content
            detailMediaContainer.classList.add('aspect-ratio-3-4'); // Apply the aspect ratio container class
            // Placeholder video for modal (YouTube)
            const defaultYouTubeModalPlaceholder = getYouTubeEmbedUrl("https://www.youtube.com/watch?v=dQw4w9WgXcQ", 1, 1, 0, 1); 

            let mediaElement;
            if (actress.mediaUrl && isYouTubeUrl(actress.mediaUrl)) {
                // Autoplay, loop, unmuted, with controls for modal
                const embedUrl = getYouTubeEmbedUrl(actress.mediaUrl, 1, 1, 0, 1); 
                console.log(`Attempting to load YouTube video in modal: ${embedUrl}`);
                mediaElement = document.createElement('iframe');
                mediaElement.src = embedUrl;
                mediaElement.setAttribute('frameborder', '0');
                mediaElement.setAttribute('allow', 'autoplay; encrypted-media; gyroscope; picture-in-picture');
                mediaElement.setAttribute('allowfullscreen', '');
                
            } else if (actress.mediaUrl && isGenericVideoUrl(actress.mediaUrl)) {
                // For generic MP4 or Google Drive links, use <video> tag
                let mediaSourceUrl = getGoogleDriveDirectLink(actress.mediaUrl);
                console.log(`Attempting to load generic video in modal: ${mediaSourceUrl}`);
                mediaElement = document.createElement('video');
                mediaElement.src = mediaSourceUrl;
                mediaElement.controls = true; // Show controls for main detail view
                mediaElement.loop = true;
                mediaElement.muted = false; // Allow sound in detail view
                mediaElement.playsinline = true;
                mediaElement.preload = 'auto'; // Preload the video
                mediaElement.onerror = (e) => {
                    console.error("Error loading generic video in modal:", e, `URL: ${mediaSourceUrl}`);
                    // Fallback to placeholder YouTube video if generic video fails to load
                    detailMediaContainer.innerHTML = `
                        <iframe src="${defaultYouTubeModalPlaceholder}" 
                                frameborder="0" allow="autoplay; encrypted-media; gyroscope; picture-in-picture" 
                                allowfullscreen>
                        </iframe>
                    `;
                    showMessage(translations[currentLang].invalidMedia, true);
                };
                mediaElement.load();
                mediaElement.play().catch(e => console.log("Generic video autoplay prevented in modal:", e));
            } else {
                // If it's not a valid video or missing, show a placeholder YouTube video
                mediaElement = document.createElement('iframe');
                mediaElement.src = defaultYouTubeModalPlaceholder;
                mediaElement.setAttribute('frameborder', '0');
                mediaElement.setAttribute('allow', 'autoplay; encrypted-media; gyroscope; picture-in-picture');
                mediaElement.setAttribute('allowfullscreen', '');
                showMessage(translations[currentLang].invalidMedia, true);
            }
            detailMediaContainer.appendChild(mediaElement);


            // Handle recommended video display - only show link, no thumbnail
            if (actress.recommendedVideoUrl && actress.recommendedVideoUrl.trim() !== '') {
                detailRecommendedVideoLink.href = actress.recommendedVideoUrl;
                detailRecommendedVideoLink.textContent = translations[currentLang].viewVideo; // Set link text
                detailRecommendedVideoContainer.classList.remove('hidden');
            } else {
                detailRecommendedVideoContainer.classList.add('hidden');
                detailRecommendedVideoLink.href = '#'; // Clear href
            }

            actressDetailModal.classList.remove('hidden');

            // --- Comments Section Setup ---
            currentActressIdForComments = actress.id;
            // Unsubscribe from previous comments listener if active
            if (unsubscribeComments) {
                unsubscribeComments();
            }
            // Set up new comments listener
            const commentsRef = collection(db, `artifacts/${appId}/public/data/actresses/${currentActressIdForComments}/comments`);
            const q = query(commentsRef, orderBy("timestamp", "desc")); // Order by newest first

            unsubscribeComments = onSnapshot(q, (snapshot) => {
                const fetchedComments = [];
                snapshot.forEach(doc => {
                    fetchedComments.push({ id: doc.id, ...doc.data() });
                });
                renderComments(fetchedComments);
            }, (error) => {
                console.error("Error listening to comments:", error);
                showMessage(translations[currentLang].dataError, true);
            });
            commentsTitle.textContent = translations[currentLang].commentsSectionTitle;
            commentTextarea.placeholder = translations[currentLang].commentPlaceholder;
            submitCommentButton.textContent = translations[currentLang].commentButton;
            commentTextarea.value = ''; // Clear comment input
        }

        // Render comments
        function renderComments(comments) {
            commentList.innerHTML = ''; // Clear existing comments
            if (comments.length === 0) {
                commentList.innerHTML = `<p class="text-gray-400 text-center">${translations[currentLang].noResults} (ç•™è¨€)</p>`; // Add a specific no comments message
                return;
            }
            comments.forEach(comment => {
                const commentItem = document.createElement('div');
                commentItem.className = 'comment-item';
                const commenterId = comment.userId || translations[currentLang].anonymousUser; // Use anonymous if userId is missing
                const timestamp = comment.timestamp ? new Date(comment.timestamp.toDate()).toLocaleString(currentLang) : translations[current.lang].unknown;

                commentItem.innerHTML = `
                    <div class="comment-meta">
                        <span class="comment-user">${commenterId}</span>
                        <span class="comment-time">${timestamp}</span>
                    </div>
                    <p class="comment-text">${comment.commentText}</p>
                `;
                commentList.appendChild(commentItem);
            });
        }

        // Add a new comment
        submitCommentButton.addEventListener('click', async () => {
            const commentText = commentTextarea.value.trim();
            if (!commentText) {
                showMessage("ç•™è¨€å…§å®¹ä¸èƒ½ç‚ºç©ºï¼", true); // Should be translated
                return;
            }

            if (!currentActressIdForComments) {
                showMessage("ç„¡æ³•æ·»åŠ ç•™è¨€ï¼Œå¥³å„ª ID ä¸å¯ç”¨ã€‚", true); // Should be translated
                return;
            }

            try {
                const commentsRef = collection(db, `artifacts/${appId}/public/data/actresses/${currentActressIdForComments}/comments`);
                await addDoc(commentsRef, {
                    userId: currentUserId || crypto.randomUUID(), // Use Firebase User ID or a random UUID for anonymous
                    commentText: commentText,
                    timestamp: serverTimestamp() // Firestore server timestamp
                });
                commentTextarea.value = ''; // Clear input
                showMessage("ç•™è¨€å·²æˆåŠŸé€å‡ºï¼"); // Should be translated
            } catch (error) {
                console.error("Error adding comment:", error);
                showMessage("ç•™è¨€å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚", true); // Should be translated
            }
        });


        // é—œé–‰å¥³å„ªè©³ç´°è³‡è¨Šå½ˆå‡ºè¦–çª—
        closeModalButton.addEventListener('click', () => {
            actressDetailModal.classList.add('hidden');
            // Pause video in modal if playing
            const videoInModal = detailMediaContainer.querySelector('video');
            const iframeInModal = detailMediaContainer.querySelector('iframe');
            if (videoInModal) {
                videoInModal.pause();
            }
            if (iframeInModal) {
                // YouTube API to stop video. This requires enablejsapi=1 parameter in embed URL
                iframeInModal.contentWindow.postMessage('{"event":"command","func":"stopVideo","args":""}', '*');
            }
            // Unsubscribe from comments listener when modal closes
            if (unsubscribeComments) {
                unsubscribeComments();
                unsubscribeComments = null;
            }
            currentActressIdForComments = null;
        });

        // é»æ“Šå½ˆå‡ºè¦–çª—å¤–éƒ¨é—œé–‰
        actressDetailModal.addEventListener('click', (event) => {
            if (event.target === actressDetailModal) {
                actressDetailModal.classList.add('hidden');
                // Pause video in modal if playing
                const videoInModal = detailMediaContainer.querySelector('video');
                const iframeInModal = detailMediaContainer.querySelector('iframe');
                if (videoInModal) {
                    videoInModal.pause();
                }
                if (iframeInModal) {
                    iframeInModal.contentWindow.postMessage('{"event":"command","func":"stopVideo","args":""}', '*');
                }
                // Unsubscribe from comments listener when modal closes
                if (unsubscribeComments) {
                    unsubscribeComments();
                    unsubscribeComments = null;
                }
                currentActressIdForComments = null;
            }
        });

        // è™•ç†æ‡‰æ´æŒ‰éˆ•é»æ“Šäº‹ä»¶
        async function handleLikeClick(actressId) {
            const actress = allActresses.find(a => a.id === actressId);
            if (!actress) return;

            try {
                const actressDocRef = doc(db, `artifacts/${appId}/public/data/actresses`, actressId);
                const updatedLikes = (actress.likes || 0) + 1;
                await updateDoc(actressDocRef, { likes: updatedLikes });

                // Update local data
                actress.likes = updatedLikes;

                // Update card UI
                const cardLikeCountElement = document.getElementById(`likes-count-${actress.id}`);
                if (cardLikeCountElement) {
                    cardLikeCountElement.textContent = updatedLikes;
                }

                // Update modal UI if open and it's the same actress
                if (!actressDetailModal.classList.contains('hidden') && detailName.textContent === getActressNameByLang(actress, currentLang)) {
                    modalLikesCount.textContent = updatedLikes;
                }
                showMessage(`${translations[currentLang].supportMessage}`);

            } catch (error) {
                console.error("Error updating likes:", error);
                showMessage(translations[currentLang].dataError, true);
            }
        }

        // Add event listener for the detail modal like button
        detailLikeButton.addEventListener('click', (e) => {
            const actressId = e.currentTarget.dataset.id;
            if (actressId) {
                handleLikeClick(actressId);
            }
        });


        // åŸ·è¡Œæœå°‹
        function performSearch() {
            const nameQuery = nameSearchInput.value.toLowerCase().trim();
            const selectedNationality = nationalityFilter.value;
            const selectedAgeGroup = ageFilter.value;
            const selectedCupSize = cupSizeFilter.value;

            const filtered = allActresses.filter(actress => {
                const age = calculateAge(actress.birthDate);
                // Search across all name fields
                const matchesName = nameQuery === '' || 
                                    (actress.name_zh_TW && actress.name_zh_TW.toLowerCase().includes(nameQuery)) ||
                                    (actress.name_zh_CN && actress.name_zh_CN.toLowerCase().includes(nameQuery)) ||
                                    (actress.name_en && actress.name_en.toLowerCase().includes(nameQuery)) ||
                                    (actress.name_ja && actress.name_ja.toLowerCase().includes(nameQuery));

                const matchesNationality = selectedNationality === '' || (actress.nationality && actress.nationality === selectedNationality);
                const matchesCupSize = selectedCupSize === '' || (actress.cupSize && actress.cupSize.toLowerCase() === selectedCupSize.toLowerCase());

                let matchesAge = true;
                if (selectedAgeGroup !== '') {
                    const [minAge, maxAge] = selectedAgeGroup.split('-').map(Number);
                    matchesAge = age >= minAge && age <= maxAge;
                }

                return matchesName && matchesNationality && matchesAge && matchesCupSize;
            });

            displayResults(filtered);
        }

        // --- å¾Œå°ç®¡ç†åŠŸèƒ½ ---
        toggleAdminButton.addEventListener('click', () => {
            adminPanelVisible = !adminPanelVisible;
            mainApp.classList.toggle('hidden', adminPanelVisible);
            homepageSections.classList.toggle('hidden', adminPanelVisible); // Hide homepage sections
            quizPanel.classList.add('hidden'); // Hide old quiz panel
            idealActressQuizPanel.classList.add('hidden'); // Hide new quiz panel
            adminPanel.classList.toggle('hidden', !adminPanelVisible);
            toggleAdminButton.textContent = adminPanelVisible ? translations[currentLang].mainSite : translations[currentLang].adminPanel;

            if (adminPanelVisible) {
                renderAdminActressList();
            }
        });

        // æ¸²æŸ“å¾Œå°å¥³å„ªåˆ—è¡¨
        document.getElementById('adminPanel').addEventListener('click', () => {
                document.getElementById('passwordGate').classList.remove('hidden');
        });
        function renderAdminActressList() {
            adminActressList.innerHTML = '';
            if (allActresses.length === 0) {
                adminActressList.innerHTML = `<p class="text-white text-center text-lg">${translations[currentLang].noResults}</p>`;
                return;
            }

            allActresses.forEach(actress => {
                const age = calculateAge(actress.birthDate);
                const actressName = getActressNameByLang(actress, currentLang); // Get localized name
                const actressItem = document.createElement('div');
                actressItem.className = 'bg-gray-900 p-4 rounded-lg shadow-md flex flex-col sm:flex-row items-center justify-between space-y-3 sm:space-y-0 sm:space-x-4 border border-gray-700'; /* æ›´æ”¹é‚Šæ¡†é¡è‰² */
                actressItem.innerHTML = `
                    <div class="flex-grow text-center sm:text-left">
                        <h3 class="text-white text-lg font-semibold">${actressName} (${age}${translations[currentLang].detailAge})</h3>
                        <p class="text-gray-400">${translations[currentLang].nationality}ï¼š${actress.nationality || translations[currentLang].unknown} | ${translations[currentLang].cupSize}ï¼š${actress.cupSize || translations[currentLang].unknown} | ${translations[currentLang].likesLabel}ï¼š${actress.likes || 0}</p>
                    </div>
                    <div class="flex space-x-2">
                        <button class="edit-btn py-2 px-4 rounded-md bg-blue-600 hover:bg-blue-700 text-white transition duration-300" data-id="${actress.id}">${translations[currentLang].edit}</button>
                        <button class="delete-btn py-2 px-4 rounded-md bg-red-600 hover:bg-red-700 text-white transition duration-300" data-id="${actress.id}">${translations[currentLang].delete}</button>
                    </div>
                `;
                adminActressList.appendChild(actressItem);
            });

            // ç¶å®šç·¨è¼¯å’Œåˆªé™¤æŒ‰éˆ•äº‹ä»¶
            document.querySelectorAll('.edit-btn').forEach(button => {
                button.addEventListener('click', (event) => editActress(event.target.dataset.id));
            });
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const actressId = event.target.dataset.id;
                    showConfirmDialog(translations[currentLang].confirmMessageText, (confirmed) => {
                        if (confirmed) {
                            deleteActress(actressId);
                        }
                    });
                });
            });
        }

        // æ–°å¢/ç·¨è¼¯å¥³å„ªè³‡æ–™       
        actressForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const actressData = {
                name_zh_TW: actressNameZhTwInput.value.trim(),
                name_zh_CN: actressNameZhCnInput.value.trim(),
                name_en: actressNameEnInput.value.trim(),
                name_ja: actressNameJaInput.value.trim(),
                nationality: actressNationalityInput.value.trim(),
                birthDate: actressBirthDateInput.value,
                cupSize: actressCupSizeInput.value.trim().toUpperCase(),
                isLegend: actressIsLegendInput.checked,
                mediaUrl: actressMediaUrlInput.value.trim(), // Will contain YouTube or generic video URL
                recommendedVideoUrl: actressRecommendedVideoUrlInput.value.trim(), 
                wikipediaLink: actressWikipediaLinkInput.value.trim(),
                description: actressDescriptionInput.value, // âœ… æ­£ç¢ºï¼
                detailedInfo: actressDetailedInfoInput.value, // âœ… ä¹Ÿè¦é€™æ¨£å¯«
                likes: 0 // New entries start with 0 likes
            }

            // Validate that at least one name field is provided (ideally zh_TW is primary)
            if (!actressData.name_zh_TW && !actressData.name_zh_CN && !actressData.name_en && !actressData.name_ja) {
                showMessage(translations[currentLang].dataError + " (è«‹è‡³å°‘æä¾›ä¸€å€‹å¥³å„ªåç¨±)", true); 
                return;
            }
            if (!actressData.nationality || !actressData.birthDate || !actressData.cupSize) {
                showMessage(translations[currentLang].dataError, true); 
                return;
            }
            
            // Validate mediaUrl: must be a YouTube URL or a generic video URL
            if (actressData.mediaUrl && !(isYouTubeUrl(actressData.mediaUrl) || isGenericVideoUrl(actressData.mediaUrl))) {
                showMessage(translations[currentLang].invalidMedia, true); // Changed error message to use translation string
                return;
            }

            try {
                if (editingActressId) {
                    // ç·¨è¼¯ç¾æœ‰å¥³å„ª
                    const actressDocRef = doc(db, `artifacts/${appId}/public/data/actresses`, editingActressId);
                    // When editing, we don't reset likes unless explicitly told to.
                    // So we fetch current likes or keep the existing one if not explicitly changed in UI.
                    const existingActress = allActresses.find(a => a.id === editingActressId);
                    actressData.likes = existingActress ? existingActress.likes : 0; // Preserve existing likes

                    await updateDoc(actressDocRef, actressData);
                    showMessage(translations[currentLang].dataSaved);
                } else {
                    // æ–°å¢å¥³å„ª
                    await addDoc(actressesCollection, {
                        ...actressData,
                        createdAt: new Date().toISOString(), // Set creation timestamp
                        totalClicks: 0, // Initialize clicks
                        likes: 0 // Initialize likes for new entries
                    });
                    showMessage(translations[currentLang].dataSaved); 
                }
                resetForm();
            } catch (error) {
                console.error("Error saving actress:", error);
                showMessage(translations[currentLang].dataError, true);
            }
        });

        // ç·¨è¼¯å¥³å„ª
        function editActress(id) {
            const actress = allActresses.find(a => a.id === id);
            if (actress) {
                editingActressId = id;
                actressNameZhTwInput.value = actress.name_zh_TW || '';
                actressNameZhCnInput.value = actress.name_zh_CN || '';
                actressNameEnInput.value = actress.name_en || '';
                actressNameJaInput.value = actress.name_ja || '';

                actressNationalityInput.value = actress.nationality;
                actressBirthDateInput.value = actress.birthDate;
                actressCupSizeInput.value = actress.cupSize;
                actressIsLegendInput.checked = actress.isLegend || false;
                actressDescriptionInput.value = actress.description || ''; // æ–°å¢
                actressDetailedInfoInput.value = actress.detailedInfo || ''; // æ–°å¢
                actressMediaUrlInput.value = actress.mediaUrl || ''; // Load media URL
                actressRecommendedVideoUrlInput.value = actress.recommendedVideoUrl || ''; 
                actressWikipediaLinkInput.value = actress.wikipediaLink;
                document.getElementById('addActressHeader').textContent = translations[currentLang].editActress;
                addEditActressButton.textContent = translations[currentLang].save;
                cancelEditButton.classList.remove('hidden');
                // Set media and video preview when editing
                updateMediaPreview(actress.mediaUrl);
                updateVideoLinkPreview(actress.recommendedVideoUrl); 
                // æ²å‹•åˆ°è¡¨å–®é ‚éƒ¨
                actressForm.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // å–æ¶ˆç·¨è¼¯
        cancelEditButton.addEventListener('click', () => {
            resetForm();
        });

        // é‡ç½®è¡¨å–®
        function resetForm() {
            editingActressId = null;
            actressForm.reset();
            document.getElementById('addActressHeader').textContent = translations[currentLang].addActress;
            addEditActressButton.textContent = translations[currentLang].add;
            cancelEditButton.classList.add('hidden');
            actressNationalityInput.value = "æ—¥æœ¬"; 
            actressDescriptionInput.value = ''; // æ–°å¢
            actressDetailedInfoInput.value = ''; // æ–°å¢
            updateMediaPreview(''); // Clear media preview
            updateVideoLinkPreview(''); 
        }

        // åˆªé™¤å¥³å„ª
        async function deleteActress(id) {
            try {
                const actressDocRef = doc(db, `artifacts/${appId}/public/data/actresses`, id);
                await deleteDoc(actressDocRef);
                showMessage(translations[currentLang].dataDeleted);
            } catch (error) {
                console.error("Error deleting actress:", error);
                showMessage(translations[currentLang].dataError, true);
            }
        }

        // Function to update the media (video only) preview in the admin panel
        function updateMediaPreview(url) {
            actressMediaPreviewContainer.innerHTML = ''; // Clear previous content
            noMediaPreviewText.style.display = 'none';
            // Default YouTube placeholder for admin preview
            const defaultYouTubeAdminPlaceholder = getYouTubeEmbedUrl("https://www.youtube.com/watch?v=dQw4w9WgXcQ", 0, 0, 1, 1); 

            if (url) {
                if (isYouTubeUrl(url)) {
                    // No autoplay for admin preview, but with controls
                    const embedUrl = getYouTubeEmbedUrl(url, 0, 0, 1, 1); 
                    console.log(`Admin Preview: Attempting to load YouTube video: ${embedUrl}`);
                    const iframeElement = document.createElement('iframe');
                    iframeElement.src = embedUrl;
                    iframeElement.setAttribute('frameborder', '0');
                    iframeElement.setAttribute('allow', 'encrypted-media; gyroscope; picture-in-picture');
                    iframeElement.setAttribute('allowfullscreen', '');
                    iframeElement.className = 'actress-card-media'; // Use existing class for styling
                    iframeElement.style.width = '140px'; /* èª¿æ•´é è¦½å¤§å° */
                    iframeElement.style.height = '105px';
                    
                    iframeElement.onload = () => {
                        console.log("Admin Preview: YouTube iframe loaded.");
                        noMediaPreviewText.style.display = 'none';
                        iframeElement.style.display = 'block';
                    };
                    iframeElement.onerror = (e) => { // onerror might not fire reliably for iframes
                        console.error("Admin Preview: Error loading YouTube iframe:", e, `URL: ${url}`);
                        noMediaPreviewText.textContent = translations[currentLang].invalidMedia;
                        noMediaPreviewText.style.display = 'block';
                        iframeElement.style.display = 'none';
                    };
                    actressMediaPreviewContainer.appendChild(iframeElement);

                } else if (isGenericVideoUrl(url)) {
                    const genericVideoUrl = getGoogleDriveDirectLink(url);
                    console.log(`Admin Preview: Attempting to load generic video: ${genericVideoUrl}`);
                    const videoElement = document.createElement('video');
                    videoElement.src = genericVideoUrl;
                    videoElement.controls = true; // Add controls to the preview video
                    videoElement.loop = true;
                    videoElement.muted = true;
                    videoElement.playsinline = true;
                    videoElement.preload = 'metadata';
                    videoElement.className = 'actress-card-media';
                    videoElement.style.width = '140px'; /* èª¿æ•´é è¦½å¤§å° */
                    videoElement.style.height = '105px';
                    
                    videoElement.onloadeddata = () => {
                        console.log("Admin Preview: Generic video data loaded.");
                        noMediaPreviewText.style.display = 'none';
                        videoElement.style.display = 'block';
                    };
                    videoElement.onerror = (e) => {
                        console.error("Admin Preview: Error loading generic video:", e, `URL: ${url}`);
                        noMediaPreviewText.textContent = translations[currentLang].invalidMedia;
                        noMediaPreviewText.style.display = 'block';
                        videoElement.style.display = 'none';
                    };
                    actressMediaPreviewContainer.appendChild(videoElement);
                    videoElement.load();
                    videoElement.play().catch(e => console.log("Admin Preview: Generic video autoplay prevented:", e));

                } else {
                    // Not a valid video URL (neither YouTube nor generic)
                    noMediaPreviewText.textContent = translations[currentLang].invalidMedia;
                    noMediaPreviewText.style.display = 'block';
                }
            } else {
                // No URL provided
                noMediaPreviewText.textContent = translations[currentLang].mediaPreviewHint;
                noMediaPreviewText.style.display = 'block';
            }
        }

        // Function to update the video link preview text in the admin panel
        function updateVideoLinkPreview(url) {
            if (url && url.trim() !== '') {
                videoLinkPreviewText.textContent = translations[currentLang].videoLinkGenerated;
                videoLinkPreviewText.style.color = '#4CAF50';
            } else {
                videoLinkPreviewText.textContent = translations[currentLang].videoLinkHint;
                videoLinkPreviewText.style.color = '#A0A0A0';
            }
        }

        // Event listener for the actressMediaUrl input to update preview
        actressMediaUrlInput.addEventListener('input', (event) => {
            updateMediaPreview(event.target.value.trim());
        });

        // Event listener for the recommended video URL input to update preview
        actressRecommendedVideoUrlInput.addEventListener('input', (event) => {
            updateVideoLinkPreview(event.target.value.trim());
        });

        // æ¸²æŸ“é¦–é çš„ç†±é–€å¥³å„ªå’Œæœ€æ–°ä¸Šç·šå¥³å„ªå€å¡Š
        function renderHomepageSections() {
            // æ¸…ç©ºç¾æœ‰å…§å®¹
            hottestActressesContainer.innerHTML = '';
            newlyAddedActressesContainer.innerHTML = '';

            // ä»Šæ—¥æœ€è¾£ (Hottest Today) - ä¾ likes é™åºæ’åˆ—ï¼Œå–å‰4å
            const hottestActresses = [...allActresses].sort((a, b) => (b.likes || 0) - (a.likes || 0)).slice(0, 4); // Sort by likes
            if (hottestActresses.length > 0) {
                hottestActresses.forEach(actress => renderActressCard(actress, hottestActressesContainer));
            } else {
                hottestActressesContainer.innerHTML = `<p class="text-white text-center col-span-full">${translations[currentLang].noResults}</p>`;
            }

            // æœ€æ–°ä¸Šç·š (Newly Added) - ä¾å‰µå»ºæ™‚é–“é™åºæ’åˆ—ï¼Œå–å‰4å
            const newlyAddedActresses = [...allActresses].sort((a, b) => new Date(b.createdAt || 0).getTime() - new Date(a.createdAt || 0).getTime()).slice(0, 4); // Changed to 4
            if (newlyAddedActresses.length > 0) {
                newlyAddedActresses.forEach(actress => renderActressCard(actress, newlyAddedActressesContainer));
            } else {
                newlyAddedActressesContainer.innerHTML = `<p class="text-white text-center col-span-full">${translations[currentLang].noResults}</p>`;
            }
        }

        // --- æ¸¬é©—éŠæˆ²é‚è¼¯ (è€å¸æ©Ÿå°±æ˜¯æˆ‘) ---
        const quizQuestions = [
            {
                question_zh_TW: "è«‹å•ä¸‰ä¸Šæ‚ äºçš„å‡ºé“å¹´ä»½æ˜¯å“ªä¸€å¹´ï¼Ÿ",
                question_zh_CN: "è¯·é—®ä¸‰ä¸Šæ‚ äºšçš„å‡ºé“å¹´ä»½æ˜¯å“ªä¸€å¹´ï¼Ÿ",
                question_en: "Which year did Yua Mikami debut?",
                question_ja: "ä¸‰ä¸Šæ‚ äºœã®ãƒ‡ãƒ“ãƒ¥ãƒ¼å¹´ã¯ä½•å¹´ã§ã™ã‹ï¼Ÿ",
                correctAnswer_zh_TW: "2015",
                correctAnswer_zh_CN: "2015",
                correctAnswer_en: "2015",
                correctAnswer_ja: "2015"
            },
            {
                question_zh_TW: "è¢«ç¨±ç‚ºã€æš—é»‘ç‰ˆæ¥Šä¸ç³ã€çš„å¥³å„ªæ˜¯èª°ï¼Ÿ",
                question_zh_CN: "è¢«ç§°ä¸ºã€æš—é»‘ç‰ˆæ¨ä¸ç³ã€çš„å¥³ä¼˜æ˜¯è°ï¼Ÿ",
                question_en: "Who is the actress known as 'Dark Rainie Yang'?",
                question_ja: "ã€Œãƒ€ãƒ¼ã‚¯ãƒ»ãƒ¬ã‚¤ãƒ‹ãƒ¼ãƒ»ãƒ¤ãƒ³ã€ã¨å‘¼ã°ã‚Œã‚‹å¥³å„ªã¯èª°ã§ã™ã‹ï¼Ÿ",
                correctAnswer_zh_TW: "æ³¢å¤šé‡çµè¡£",
                correctAnswer_zh_CN: "æ³¢å¤šé‡ç»“è¡£",
                correctAnswer_en: "Yui Hatano",
                correctAnswer_ja: "æ³¢å¤šé‡çµè¡£"
            },
            {
                question_zh_TW: "ä»¥ä¸‹å“ªä½å¥³å„ªæ˜¯ä»¥ç«¥é¡å·¨ä¹³è‘—ç¨±ï¼Ÿ (é¸é …ï¼šæ–°æœ‰èœ, çŸ³å·æ¾ª, æˆ¶ç”°çœŸç´)",
                question_zh_CN: "ä»¥ä¸‹å“ªä½å¥³ä¼˜æ˜¯ä»¥ç«¥é¢œå·¨ä¹³è‘—ç§°ï¼Ÿ (é€‰é¡¹ï¼šæ–°æœ‰èœ, çŸ³å·æ¾ª, æˆ·ç”°çœŸç´)",
                question_en: "Which of the following actresses is known for her 'baby face and big breasts'? (Options: Arina Arina, Mio Ishikawa, Makoto Toda)",
                question_ja: "æ¬¡ã®å¥³å„ªã®ã†ã¡ã€ç«¥é¡”å·¨ä¹³ã§çŸ¥ã‚‰ã‚Œã¦ã„ã‚‹ã®ã¯èª°ã§ã™ã‹ï¼Ÿ (é¸æŠè‚¢ï¼šæ–°æœ‰èœã€çŸ³å·æ¾ªã€æˆ¸ç”°çœŸç´)",
                correctAnswer_zh_TW: "æ–°æœ‰èœ",
                correctAnswer_zh_CN: "æ–°æœ‰èœ",
                correctAnswer_en: "Arina Arina",
                correctAnswer_ja: "æ–°æœ‰èœ"
            },
            {
                question_zh_TW: "å“ªä½å¥³å„ªæ›¾åœ¨éŸ“åœ‹ç™¼å±•éå¥³åœ˜æ´»å‹•ï¼Ÿ",
                question_zh_CN: "å“ªä½å¥³ä¼˜æ›¾åœ¨éŸ©å›½å‘å±•è¿‡å¥³å›¢æ´»åŠ¨ï¼Ÿ",
                question_en: "Which actress had girl group activities in Korea?",
                correctAnswer_zh_TW: "ä¸‰ä¸Šæ‚ äº",
                correctAnswer_CN: "ä¸‰ä¸Šæ‚ äºš",
                correctAnswer_en: "Yua Mikami",
                correctAnswer_ja: "ä¸‰ä¸Šæ‚ äºœ"
            },
            {
                question_zh_TW: "å“ªä½å¥³å„ªçš„ä»£è¡¨ä½œæ˜¯ã€Šçµ•å°èª˜æƒ‘ã€‹ç³»åˆ—ï¼Ÿ",
                question_zh_CN: "å“ªä½å¥³ä¼˜çš„ä»£è¡¨ä½œæ˜¯ã€Šç»å¯¹è¯±æƒ‘ã€‹ç³»åˆ—ï¼Ÿ",
                question_en: "Which actress's representative work is the 'Absolute Seduction' series?",
                correctAnswer_zh_TW: "JULIA",
                correctAnswer_zh_CN: "JULIA",
                correctAnswer_en: "JULIA",
                correctAnswer_ja: "JULIA"
            },
            {
                question_zh_TW: "å“ªä½å¥³å„ªä»¥å…¶æ´»æ½‘é–‹æœ—çš„æ€§æ ¼å’Œç¬‘å®¹æ·±å—æ­¡è¿ï¼Ÿ",
                question_zh_CN: "å“ªä½å¥³ä¼˜ä»¥å…¶æ´»æ³¼å¼€æœ—çš„æ€§æ ¼å’Œç¬‘å®¹æ·±å—æ¬¢è¿ï¼Ÿ",
                question_en: "Which actress is popular for her cheerful personality and smile?",
                correctAnswer_zh_TW: "æ©‹æœ¬æœ‰èœ",
                correctAnswer_zh_CN: "æ¡¥æœ¬æœ‰èœ",
                correctAnswer_en: "Arina Hashimoto",
                correctAnswer_ja: "æ©‹æœ¬æœ‰èœ"
            },
            {
                question_zh_TW: "å“ªä½å¥³å„ªæ˜¯åŸAKB48æˆå“¡ï¼Ÿ",
                question_zh_CN: "å“ªä½å¥³ä¼˜æ˜¯åŸAKB48æˆå‘˜ï¼Ÿ",
                question_en: "Which actress was a former AKB48 member?",
                correctAnswer_zh_TW: "ä¸‰ä¸Šæ‚ äº",
                correctAnswer_zh_CN: "ä¸‰ä¸Šæ‚ äºš",
                correctAnswer_en: "Yua Mikami",
                correctAnswer_ja: "ä¸‰ä¸Šæ‚ äºœ"
            },
            {
                question_zh_TW: "å“ªä½å¥³å„ªè¢«ç¨±ç‚ºã€æƒ æ¯”å£½éºé¦™è‘¡è„ã€çš„éšŠé•·ï¼Ÿ",
                question_zh_CN: "å“ªä½å¥³ä¼˜è¢«ç§°ä¸ºã€æƒ æ¯”å¯¿éºé¦™è‘¡è„ã€çš„é˜Ÿé•¿ï¼Ÿ",
                question_en: "Which actress is known as the leader of 'Ebisu Muscats'?",
                correctAnswer_zh_TW: "æ˜æ—¥èŠ±ã‚­ãƒ©ãƒ©",
                correctAnswer_zh_CN: "æ˜æ—¥èŠ±ã‚­ãƒ©ãƒ©",
                correctAnswer_en: "Kirara Asuka",
                correctAnswer_ja: "æ˜æ—¥èŠ±ã‚­ãƒ©ãƒ©"
            },
            {
                question_zh_TW: "å“ªä½å¥³å„ªä»¥å¥¹çš„è¶…å¤§ç¾å°»èåï¼Ÿ",
                question_zh_CN: "å“ªä½å¥³ä¼˜ä»¥å¥¹çš„è¶…å¤§ç¾å°»é—»åï¼Ÿ",
                question_en: "Which actress is famous for her exceptionally large beautiful buttocks?",
                correctAnswer_zh_TW: "æ¤åç©º",
                correctAnswer_zh_CN: "æ¤åç©º",
                correctAnswer_en: "Sora Shiina",
                correctAnswer_ja: "æ¤åãã‚‰"
            },
            {
                question_zh_TW: "å“ªä½å¥³å„ªçš„è—åæ˜¯ä»¥æ°´æœå‘½åï¼Ÿ",
                question_zh_CN: "å“ªä½å¥³ä¼˜çš„è‰ºåæ˜¯ä»¥æ°´æœå‘½åï¼Ÿ",
                question_en: "Which actress's stage name is named after a fruit?",
                correctAnswer_zh_TW: "æ¡ƒä¹ƒæœ¨é¦™å¥ˆ",
                correctAnswer_zh_CN: "æ¡ƒä¹ƒæœ¨é¦™å¥ˆ",
                correctAnswer_en: "Kana Momonogi",
                correctAnswer_ja: "æ¡ƒä¹ƒæœ¨ã‹ãª"
            }
        ];
        
        let shuffledQuizQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        const specialVideoUrl = "https://www.youtube.com/embed/dQw4w9WgXcQ?autoplay=1&mute=0&controls=1&loop=1&playlist=dQw4w9WgXcQ"; // Rick Astley - Never Gonna Give You Up

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function startGame() {
            shuffledQuizQuestions = shuffleArray([...quizQuestions]);
            currentQuestionIndex = 0;
            score = 0;
            quizInput.value = '';
            quizResultSection.classList.add('hidden');
            specialVideoContainer.classList.add('hidden');
            specialVideoPlayer.src = ''; // Clear video
            nextQuestionButton.classList.remove('hidden');
            submitQuizButton.classList.add('hidden');
            quizPanel.classList.add('active-quiz'); // Add active state for styling/logic

            displayQuestion();
        }

        function displayQuestion() {
            if (currentQuestionIndex < shuffledQuizQuestions.length) {
                const question = shuffledQuizQuestions[currentQuestionIndex];
                const questionKey = `question_${currentLang.replace('-', '_')}`;
                quizQuestionElement.textContent = `${translations[currentLang].quizQuestionNum}${currentQuestionIndex + 1}${translations[currentLang].quizQuestionText}: ${question[questionKey]}`;
                quizInput.value = ''; // Clear input for new question
                quizInput.focus();

                if (currentQuestionIndex === shuffledQuizQuestions.length - 1) {
                    nextQuestionButton.classList.add('hidden');
                    submitQuizButton.classList.remove('hidden');
                } else {
                    nextQuestionButton.classList.remove('hidden');
                    submitQuizButton.classList.add('hidden');
                }
            }
        }

        function checkAnswer() {
            const userAnswer = quizInput.value.toLowerCase().trim();
            const question = shuffledQuizQuestions[currentQuestionIndex];
            const correctAnswerKey = `correctAnswer_${currentLang.replace('-', '_')}`;
            const correctAnswer = question[correctAnswerKey].toLowerCase().trim();

            if (userAnswer === correctAnswer) {
                score++;
            }
            
            currentQuestionIndex++;
            if (currentQuestionIndex < shuffledQuizQuestions.length) {
                displayQuestion();
            } else {
                finishQuiz();
            }
        }

        function finishQuiz() {
            quizInput.classList.add('hidden');
            nextQuestionButton.classList.add('hidden');
            submitQuizButton.classList.add('hidden');
            quizResultSection.classList.remove('hidden');
            quizPanel.classList.remove('active-quiz'); // Remove active state

            quizScoreText.textContent = `${translations[currentLang].yourScore}: ${score} / ${shuffledQuizQuestions.length}`;

            if (score === shuffledQuizQuestions.length) {
                quizResultMessage.textContent = translations[currentLang].congratulations;
                viewSpecialVideoButton.classList.remove('hidden');
                tryAgainButton.classList.add('hidden');
            } else {
                quizResultMessage.textContent = translations[currentLang].failedQuiz;
                viewSpecialVideoButton.classList.add('hidden');
                tryAgainButton.classList.remove('hidden');
            }
        }

        viewSpecialVideoButton.addEventListener('click', () => {
            specialVideoContainer.classList.remove('hidden');
            specialVideoPlayer.src = specialVideoUrl;
            // Use postMessage to play the video in the iframe
            specialVideoPlayer.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', '*');
            viewSpecialVideoButton.classList.add('hidden'); // Hide button after clicking
        });

        tryAgainButton.addEventListener('click', () => {
            quizResultSection.classList.add('hidden');
            specialVideoContainer.classList.add('hidden');
            specialVideoPlayer.src = '';
            quizInput.classList.remove('hidden');
            startGame();
        });

        nextQuestionButton.addEventListener('click', checkAnswer);
        submitQuizButton.addEventListener('click', checkAnswer); // Last question uses submit button

        // --- å¿ƒç†æ¸¬é©—éŠæˆ²é‚è¼¯ (èª°æ˜¯æˆ‘çš„ç†æƒ³å¥³å„ªï¼Ÿ) ---
        const idealActressQuizQuestions = [
            {
                question_zh_TW: "ä½ å–œæ­¡çš„å¥³å„ªé¡å‹æ˜¯ï¼Ÿ",
                question_zh_CN: "ä½ å–œæ¬¢çš„å¥³ä¼˜ç±»å‹æ˜¯ï¼Ÿ",
                question_en: "What type of actress do you prefer?",
                question_ja: "ã‚ãªãŸãŒå¥½ããªå¥³å„ªã®ã‚¿ã‚¤ãƒ—ã¯ï¼Ÿ",
                options: [
                    { text_zh_TW: "æ´»åŠ›é™½å…‰å‹", text_zh_CN: "æ´»åŠ›é˜³å…‰å‹", text_en: "Energetic and sunny", text_ja: "å…ƒæ°—ã§æ˜ã‚‹ã„ã‚¿ã‚¤ãƒ—", type: 'A' },
                    { text_zh_TW: "æº«æŸ”æ°£è³ªå‹", text_zh_CN: "æ¸©æŸ”æ°”è´¨å‹", text_en: "Gentle and elegant", text_ja: "ç©ã‚„ã‹ã§ä¸Šå“ãªã‚¿ã‚¤ãƒ—", type: 'B' },
                    { text_zh_TW: "æ€§æ„Ÿæˆç†Ÿå‹", text_zh_CN: "æ€§æ„Ÿæˆç†Ÿå‹", text_en: "Sexy and mature", text_ja: "ã‚»ã‚¯ã‚·ãƒ¼ã§å¤§äººã£ã½ã„ã‚¿ã‚¤ãƒ—", type: 'C' }
                ]
            },
            {
                question_zh_TW: "ä½ å°å¥³å„ªçš„å¸å¼•åŠ›ä¸»è¦ä¾†è‡ªï¼Ÿ",
                question_zh_CN: "ä½ å¯¹å¥³ä¼˜çš„å¸å¼•åŠ›ä¸»è¦æ¥è‡ªï¼Ÿ",
                question_en: "Your attraction to an actress mainly comes from?",
                question_ja: "å¥³å„ªã®é­…åŠ›ã¯ä¸»ã«ã©ã“ã‹ã‚‰ï¼Ÿ",
                options: [
                    { text_zh_TW: "ç”œç¾ç¬‘å®¹", text_zh_CN: "ç”œç¾ç¬‘å®¹", text_en: "Sweet smile", text_ja: "ç”˜ã„ç¬‘é¡”", type: 'A' },
                    { text_zh_TW: "æ¸…ç´”å¯æ„›", text_zh_CN: "æ¸…çº¯å¯çˆ±", text_en: "Pure and cute", text_ja: "æ¸…ç´”ã§å¯æ„›ã„", type: 'B' },
                    { text_zh_TW: "ç«è¾£èº«æ", text_zh_CN: "ç«è¾£èº«æ", text_en: "Hot figure", text_ja: "ãƒ›ãƒƒãƒˆãªã‚¹ã‚¿ã‚¤ãƒ«", type: 'C' }
                ]
            },
            {
                question_zh_TW: "ç•¶ä½ å¿ƒæƒ…ä¸å¥½æ™‚ï¼Œä½ æœƒå¸Œæœ›å¥³å„ªæ€éº¼å®‰æ…°ä½ ï¼Ÿ",
                question_zh_CN: "å½“ä½ å¿ƒæƒ…ä¸å¥½æ—¶ï¼Œä½ ä¼šå¸Œæœ›å¥³ä¼˜æ€ä¹ˆå®‰æ…°ä½ ï¼Ÿ",
                question_en: "When you're feeling down, how would you want an actress to comfort you?",
                question_ja: "æ°—åˆ†ãŒè½ã¡è¾¼ã‚“ã§ã„ã‚‹æ™‚ã€å¥³å„ªã«ã©ã†æ…°ã‚ã¦ã»ã—ã„ã§ã™ã‹ï¼Ÿ",
                options: [
                    { text_zh_TW: "æº«æŸ”é™ªä¼´ï¼Œéœéœè†è½", text_zh_CN: "æ¸©æŸ”é™ªä¼´ï¼Œé™é™è†å¬", text_en: "Gentle companionship, quietly listening", text_ja: "å„ªã—ãå¯„ã‚Šæ·»ã„ã€é™ã‹ã«è©±ã‚’èã„ã¦ã»ã—ã„", type: 'B' },
                    { text_zh_TW: "é–‹æœ—æ´»æ½‘ï¼Œé€—ä½ é–‹å¿ƒ", text_zh_CN: "å¼€æœ—æ´»æ³¼ï¼Œé€—ä½ å¼€å¿ƒ", text_en: "Cheerful and lively, making you happy", text_ja: "æ˜ã‚‹ãæŒ¯ã‚‹èˆã„ã€ç¬‘ã‚ã›ã¦ã»ã—ã„", type: 'A' },
                    { text_zh_TW: "çµ¦ä½ ä¸€å€‹ç†±æƒ…çš„æ“æŠ±", text_zh_CN: "ç»™ä½ ä¸€ä¸ªçƒ­æƒ…çš„æ“æŠ±", text_en: "Giving you a passionate hug", text_ja: "æƒ…ç†±çš„ãªãƒã‚°ã‚’ã—ã¦ã»ã—ã„", type: 'C' }
                ]
            }
        ];

        let currentIdealActressQuestionIndex = 0;
        let idealActressScores = { 'A': 0, 'B': 0, 'C': 0 };

        function startIdealActressQuiz() {
            currentIdealActressQuestionIndex = 0;
            idealActressScores = { 'A': 0, 'B': 0, 'C': 0 };
            idealActressQuizResultSection.classList.add('hidden');
            idealActressResultVideoContainer.classList.add('hidden'); // Hide video container
            idealActressResultVideoPlayer.src = ''; // Clear video source
            idealActressQuizPanel.classList.add('active-quiz');
            displayIdealActressQuestion();
        }

        function displayIdealActressQuestion() {
            if (currentIdealActressQuestionIndex < idealActressQuizQuestions.length) {
                const question = idealActressQuizQuestions[currentIdealActressQuestionIndex];
                const questionKey = `question_${currentLang.replace('-', '_')}`;
                idealActressQuizQuestionElement.textContent = question[questionKey];
                idealActressQuizOptionsContainer.innerHTML = ''; // Clear previous options

                question.options.forEach((option, index) => {
                    const optionButton = document.createElement('button');
                    const optionTextKey = `text_${currentLang.replace('-', '_')}`;
                    optionButton.textContent = `${String.fromCharCode(65 + index)}. ${option[optionTextKey]}`; // A, B, C...
                    optionButton.className = 'ideal-quiz-option-button'; // Use common class for styling
                    optionButton.dataset.type = option.type;
                    optionButton.addEventListener('click', () => selectIdealActressOption(option.type));
                    idealActressQuizOptionsContainer.appendChild(optionButton);
                });
            } else {
                finishIdealActressQuiz();
            }
        }

        function selectIdealActressOption(type) {
            idealActressScores[type]++;
            currentIdealActressQuestionIndex++;
            displayIdealActressQuestion();
        }

        function finishIdealActressQuiz() {
            let maxScore = -1;
            let idealType = null;
            let isTie = false;

            for (const type in idealActressScores) {
                if (idealActressScores[type] > maxScore) {
                    maxScore = idealActressScores[type];
                    idealType = type;
                    isTie = false;
                } else if (idealActressScores[type] === maxScore) {
                    isTie = true; // Indicates a tie
                }
            }

            // Define the result texts directly here, avoiding needing the translation keys for them
            const idealActressQuizResults = {
                'zh-TW': {
                    'A': "æ­å–œï¼ä½ çš„ç†æƒ³å¥³å„ªæ˜¯æ“æœ‰é™½å…‰ç¬‘å®¹èˆ‡æ´»åŠ›çš„ **æ–°æœ‰èœ**ï¼",
                    'B': "æ­å–œï¼ä½ çš„ç†æƒ³å¥³å„ªæ˜¯æº«æŸ”å©‰ç´„ã€æ°£è³ªå‡ºçœ¾çš„ **ä¸‰ä¸Šæ‚ äº**ï¼",
                    'C': "æ­å–œï¼ä½ çš„ç†æƒ³å¥³å„ªæ˜¯æ€§æ„Ÿç«è¾£ã€å……æ»¿æˆç†Ÿé­…åŠ›çš„ **æ³¢å¤šé‡çµè¡£**ï¼",
                    'tie': "ä½ çš„é¸æ“‡å‘ˆç¾å¤šæ¨£æ€§ï¼ç„¡æ³•æ˜ç¢ºåˆ¤æ–·ä½ çš„ç†æƒ³é¡å‹ï¼Œä½†ä½ å°AVå¥³å„ªçš„æ„›æ˜¯å»£é—Šçš„ï¼"
                },
                'zh-CN': {
                    'A': "æ­å–œï¼ä½ çš„ç†æƒ³å¥³ä¼˜æ˜¯æ‹¥æœ‰é˜³å…‰ç¬‘å®¹ä¸æ´»åŠ›çš„ **æ–°æœ‰èœ**ï¼",
                    'B': "æ­å–œï¼ä½ çš„ç†æƒ³å¥³ä¼˜æ˜¯æ¸©æŸ”å©‰çº¦ã€æ°”è´¨å‡ºä¼—çš„ **ä¸‰ä¸Šæ‚ äºš**ï¼",
                    'C': "æ­å–œï¼ä½ çš„ç†æƒ³å¥³ä¼˜æ˜¯æ€§æ„Ÿç«è¾£ã€å……æ»¡æˆç†Ÿé­…åŠ›çš„ **æ³¢å¤šé‡ç»“è¡£**ï¼",
                    'tie': "ä½ çš„é€‰æ‹©å‘ˆç°å¤šæ ·æ€§ï¼æ— æ³•æ˜ç¡®åˆ¤æ–­ä½ çš„ç†æƒ³ç±»å‹ï¼Œä½†ä½ å¯¹AVå¥³ä¼˜çš„çˆ±æ˜¯å¹¿é˜”çš„ï¼"
                },
                'en': {
                    'A': "Congratulations! Your ideal actress is the energetic and sunny **Arina Arina**!",
                    'B': "Congratulations! Your ideal actress is the gentle and elegant **Yua Mikami**!",
                    'C': "Congratulations! Your ideal actress is the sexy and mature **Yui Hatano**!",
                    'tie': "Your choices show diversity! It's hard to pinpoint one ideal type, but your love for AV actresses is vast!"
                },
                'ja': {
                    'A': "ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ã‚ãªãŸã®ç†æƒ³ã®å¥³å„ªã¯ã€æ˜ã‚‹ã„ç¬‘é¡”ã¨æ´»æ°—ã«æº€ã¡ãŸ**æ–°æœ‰èœ**ã§ã™ï¼",
                    'B': "ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ã‚ãªãŸã®ç†æƒ³ã®å¥³å„ªã¯ã€å„ªé›…ã§ä¸Šå“ãª**ä¸‰ä¸Šæ‚ äºœ**ã§ã™ï¼",
                    'C': "ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ã‚ãªãŸã®ç†æƒ³ã®å¥³å„ªã¯ã€ã‚»ã‚¯ã‚·ãƒ¼ã§æˆç†Ÿã—ãŸé­…åŠ›ã‚’æŒã¤**æ³¢å¤šé‡çµè¡£**ã§ã™ï¼",
                    'tie': "ã‚ãªãŸã®é¸æŠã¯å¤šæ§˜æ€§ã‚’ç¤ºã—ã¦ã„ã¾ã™ï¼ç†æƒ³ã®ã‚¿ã‚¤ãƒ—ã‚’ç‰¹å®šã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ãŒã€AVå¥³å„ªã¸ã®æ„›ã¯åºƒå¤§ã§ã™ï¼"
                }
            };


            let resultText = '';
            let actressNameForVideo = ''; // To store the actress name for video lookup

            if (isTie) {
                resultText = idealActressQuizResults[currentLang]['tie'];
            } else {
                resultText = idealActressQuizResults[currentLang][idealType];
                if (idealType === 'A') actressNameForVideo = 'æ–°æœ‰èœ';
                else if (idealType === 'B') actressNameForVideo = 'ä¸‰ä¸Šæ‚ äº';
                else if (idealType === 'C') actressNameForVideo = 'æ³¢å¤šé‡çµè¡£';
            }
            
            idealActressQuizResultText.innerHTML = resultText; // Use innerHTML for bold text
            idealActressQuizResultSection.classList.remove('hidden');
            idealActressQuizOptionsContainer.classList.add('hidden'); // Hide options
            idealActressQuizQuestionElement.classList.add('hidden'); // Hide question
            idealActressQuizPanel.classList.remove('active-quiz');

            // Find the actress and display their video
            const targetActress = allActresses.find(a => a.name_zh_TW === actressNameForVideo);
            if (targetActress && targetActress.mediaUrl) {
                // Autoplay, loop, unmuted, with controls for modal. This ensures autoplay.
                const embedUrl = getYouTubeEmbedUrl(targetActress.mediaUrl, 1, 1, 0, 1); 
                idealActressResultVideoPlayer.src = embedUrl;
                idealActressResultVideoPlayer.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', '*'); // Force autoplay
                idealActressResultVideoContainer.classList.remove('hidden');
            } else {
                idealActressResultVideoContainer.classList.add('hidden');
                idealActressResultVideoPlayer.src = '';
            }
        }

        idealActressTryAgainButton.addEventListener('click', () => {
            idealActressQuizResultSection.classList.add('hidden');
            idealActressResultVideoContainer.classList.add('hidden'); // Hide video container when restarting
            idealActressResultVideoPlayer.src = ''; // Clear video source
            idealActressQuizOptionsContainer.classList.remove('hidden');
            idealActressQuizQuestionElement.classList.remove('hidden');
            startIdealActressQuiz();
        });


        // --- é é¢é¡¯ç¤ºåˆ‡æ› ---
        showQuizButton.addEventListener('click', () => {
            mainApp.classList.add('hidden');
            adminPanel.classList.add('hidden');
            homepageSections.classList.add('hidden'); 
            idealActressQuizPanel.classList.add('hidden'); // Hide new quiz panel
            quizPanel.classList.remove('hidden');
            startGame(); // Start the old quiz when the button is clicked
        });

        showIdealActressQuizButton.addEventListener('click', () => {
            mainApp.classList.add('hidden');
            adminPanel.classList.add('hidden');
            homepageSections.classList.add('hidden');
            quizPanel.classList.add('hidden'); // Hide old quiz panel
            idealActressQuizPanel.classList.remove('hidden');
            startIdealActressQuiz(); // Start the new quiz
        });


        backToMainFromQuizButton.addEventListener('click', () => {
            quizPanel.classList.add('hidden');
            mainApp.classList.remove('hidden');
            homepageSections.classList.remove('hidden'); 
            quizInput.classList.remove('hidden'); // Ensure input is visible for next game
            quizResultSection.classList.add('hidden'); // Hide results
            specialVideoContainer.classList.add('hidden'); // Hide video
            // Stop video in special quiz
            specialVideoPlayer.contentWindow.postMessage('{"event":"command","func":"stopVideo","args":""}', '*');
            specialVideoPlayer.src = ''; // Clear video
        });

        backToMainFromIdealQuizButton.addEventListener('click', () => {
            idealActressQuizPanel.classList.add('hidden');
            mainApp.classList.remove('hidden');
            homepageSections.classList.remove('hidden');
            idealActressQuizOptionsContainer.classList.remove('hidden'); // Ensure options are visible for next game
            idealActressQuizQuestionElement.classList.remove('hidden'); // Ensure question is visible
            idealActressResultVideoContainer.classList.add('hidden'); // Hide video container when going back to main
            // Stop video in ideal actress quiz
            idealActressResultVideoPlayer.contentWindow.postMessage('{"event":"command","func":"stopVideo","args":""}', '*');
            idealActressResultVideoPlayer.src = ''; // Clear video source
        });

        // Function to hide all main content areas (not needed with age gate removed, but keep for other hide logic)
        function hideAllContent() {
            homepageSections.classList.add('hidden');
            mainApp.classList.add('hidden');
            adminPanel.classList.add('hidden');
            quizPanel.classList.add('hidden');
            idealActressQuizPanel.classList.add('hidden');
        }

        // Function to show main app content (now always called on init)
        function showMainAppContent() {
            homepageSections.classList.remove('hidden');
            mainApp.classList.remove('hidden');
            // Hide other panels explicitly
            adminPanel.classList.add('hidden');
            quizPanel.classList.add('hidden');
            idealActressQuizPanel.classList.add('hidden');
        }

        // Encapsulate the original DOMContentLoaded logic into a function
        function initializeAppContent() {
            // Firebase initialization
            app = initializeApp(firebaseConfig); 
            auth = getAuth(app);
            db = getFirestore(app);
            actressesCollection = collection(db, `artifacts/${appId}/public/data/actresses`);

            // Firebase Auth Listener
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    currentUserId = user.uid;
                } else {
                    // åœ¨ GitHub Pages ç’°å¢ƒä¸‹ï¼Œ__initial_auth_token ä¸å­˜åœ¨ï¼Œç›´æ¥é€²è¡ŒåŒ¿åç™»å…¥
                    await signInAnonymously(auth);
                    currentUserId = auth.currentUser.uid;
                }
                isAuthReady = true;
                console.log("Firebase Auth Ready. User ID:", currentUserId);
                setupFirestoreListeners(); // Setup Firestore listener after auth is ready
            });

            // Add event listener for the search button
            searchButton.addEventListener('click', performSearch);

            // Update Ad Section 1 with the provided Google Drive image
           function getGoogleDriveImageSrc(driveUrl) {
                const match = driveUrl.match(/\/d\/([^/]+)\//);
                if (match && match[1]) {
                    const fileId = match[1];
                    return `https://drive.google.com/uc?export=view&id=${fileId}`;
                } else {
                    console.warn("â— ç„¡æ³•è§£æ Google Drive åœ–ç‰‡ IDï¼Œè«‹æª¢æŸ¥ç¶²å€æ ¼å¼æ˜¯å¦ç‚ºï¼š https://drive.google.com/file/d/FILE_ID/view");
                    return '';
                }
            }

         window.addEventListener('DOMContentLoaded', () => {
                const googleDriveAdUrl1 = 'https://drive.google.com/file/d/1Q5piwFkOS6w1iUiGd2I66t4IG2WngJYc/view?usp=sharing';
                const adImageUrl = getGoogleDriveImageSrc(googleDriveAdUrl1);

                if (adImageUrl && adSection1) {
                        adSection1.innerHTML = `
                            <img src="${adImageUrl}" alt="å»£å‘Šåœ–" class="w-full h-auto rounded-lg shadow-md border border-gray-500">
                        `;
                    } else {
                            console.error("âŒ ç„¡æ³•é¡¯ç¤ºå»£å‘Šåœ–ç‰‡ï¼šadImageUrl æˆ– adSection1 ç‚º null");
                    }
                });
            // Update Ad Section 2 with a Google Drive image (placeholder example)
            const googleDriveImagePlaceholderUrl = 'https://drive.google.com/file/d/1Z_D3-JvN4V-B3F7G6H8I9K0L1M2N3O4P/view'; // Placeholder URL, replace with actual
            adSection2.innerHTML = `<img src="${getGoogleDriveImageSrc(googleDriveImagePlaceholderUrl)}" alt="Google Drive å»£å‘Šç¯„ä¾‹" class="w-full h-auto rounded-lg">`;


            // Set up language switcher and apply initial translations
            setupLanguageSwitcher();
            applyTranslations();
            updateMediaPreview(''); // Initialize media preview with empty state
            updateVideoLinkPreview(''); // Initialize video link preview with empty state
            showMainAppContent(); // Ensure main content is visible on initialization
        }

        // Directly call initializeAppContent on DOMContentLoaded
        document.addEventListener('DOMContentLoaded', initializeAppContent);
        document.addEventListener('DOMContentLoaded', () => {
              const correctPassword = 'JASAMI9521';
    
              const passwordGate = document.getElementById('passwordGate');
              const adminPanel = document.getElementById('adminPanel');
              const passwordInput = document.getElementById('adminPasswordInput');
              const submitPasswordBtn = document.getElementById('submitPasswordBtn');
              const passwordError = document.getElementById('passwordError');

              submitPasswordBtn.addEventListener('click', () => {
                    const entered = passwordInput.value.trim();
                    if (entered === correctPassword) {
                          passwordGate.classList.add('hidden');
                          adminPanel.classList.remove('hidden');
                    } else {
                          passwordError.classList.remove('hidden');
                    }
              });

      // æŒ‰ä¸‹ Enter ä¹Ÿèƒ½é€å‡º
                 passwordInput.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                              submitPasswordBtn.click();
                        }
                 });
            });
    </script>
</body>
</html>
